<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="React的基本使用, Heylog&#39;s blog">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>React的基本使用 | Heylog&#39;s blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.2.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="Heylog's blog" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Heylog&#39;s blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Heylog&#39;s blog</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/0.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">React的基本使用</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="container content">

    
    <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/React/">
                                <span class="chip bg-color">React</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/React/" class="post-category">
                                React
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2020-02-12
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="1-React简介"><a href="#1-React简介" class="headerlink" title="1. React简介"></a>1. React简介</h1><h2 id="1-1-React介绍"><a href="#1-1-React介绍" class="headerlink" title="1.1 React介绍"></a>1.1 React介绍</h2><ul>
<li><p>React 是一个用于构建用户界面的 JAVASCRIPT库。React主要用于构建UI，很多人认为 React 是 MVC 中的 V（视图）。</p>
</li>
<li><p>React 起源于 Facebook 的内部项目，因为该公司对市场上所有 JavaScript MVC 框架都不满意，就决定自己写一套，用来架设 Instagram（照片交友） 的网站。做出来以后，发现这套东西很好用，<strong>就在2013年5月开源了</strong>。</p>
</li>
<li><p>React 拥有较高的性能，代码逻辑非常简单，越来越多的人已开始关注和使用它。由于 React 的<strong>设计思想极其独特</strong>，属于革命性创新，性能出众，代码逻辑却非常简单。所以，越来越多的人开始关注和使用，认为它可能是将来 Web 开发的主流工具。</p>
</li>
<li><p>清楚两个概念：</p>
<ul>
<li><p>library（库）：小而巧的库，只提供了特定的API；优点就是 船小好掉头，可以很方便的从一个库切换到另外的库；但是代码几乎不会改变；比如从jQuery切换到</p>
</li>
<li><p>Framework（框架）：大而全的是框架；框架提供了一整套的解决方案；所以如果在项目中间，想切换到另外的框架，是比较困难的；</p>
</li>
</ul>
</li>
</ul>
<h2 id="1-2-前端三大主流框架"><a href="#1-2-前端三大主流框架" class="headerlink" title="1.2 前端三大主流框架"></a>1.2 前端三大主流框架</h2><ul>
<li>Angular.js：出来<strong>较早</strong>的前端框架，学习曲线比较陡，NG1学起来比较麻烦，NG2 ~ NG5开始，进行了一系列的改革，也提供了组件化开发的概念；从NG2开始，也支持使用TS（TypeScript）进行编程；</li>
</ul>
<ul>
<li><p>Vue.js：<strong>最火</strong>（关注的人比较多）的一门前端框架，它是中国人开发的，对我们来说，文档要友好一些；</p>
</li>
<li><p>React.js：<strong>最流行</strong>（用的人比较多）的一门框架，因为它的设计很优秀；</p>
</li>
</ul>
<h2 id="1-3-React与Vue的对比"><a href="#1-3-React与Vue的对比" class="headerlink" title="1.3 React与Vue的对比"></a>1.3 React与Vue的对比</h2><p><strong>1、监听数据变化的实现原理不同</strong></p>
<ul>
<li><p>Vue 通过 getter/setter 以及一些函数的劫持，能精确知道数据变化，不需要特别的优化就能达到很好的性能</p>
</li>
<li><p>React 默认是通过比较引用地址的方式进行的，如果不优化   </p>
<p>（PureComponent/shouldComponentUpdate）可能导致大量不必要的VDOM的重新渲染</p>
</li>
</ul>
<p><strong>2、数据流的不同</strong></p>
<p><img src="https://i.loli.net/2020/11/09/2wyqtVuSrnXYkc4.png" alt="1574133046838.png"></p>
<p>大家都知道Vue中默认是支持双向绑定的。在Vue1.0中我们可以实现两种双向绑定：</p>
<ol>
<li>父子组件之间，props 可以双向绑定</li>
<li>组件与DOM之间可以通过 v-model 双向绑定</li>
</ol>
<p>在 Vue2.x 中去掉了第一种，也就是父子组件之间不能双向绑定了（但是提供了一个语法糖自动帮你通过事件的方式修改），并且 Vue2.x 已经不鼓励组件对自己的 props 进行任何修改了。所以现在我们只有 组件 &lt;––&gt; DOM 之间的双向绑定这一种。</p>
<p>然而 React 从诞生之初就不支持双向绑定，React一直提倡的是单向数据流，他称之为 onChange/setState()模式。</p>
<p>不过由于我们一般都会用 Vuex 以及 Redux 等单向数据流的状态管理框架，因此很多时候我们感受不到这一点的区别了。</p>
<p><strong>3、模板渲染方式的不同</strong></p>
<p>在表层上， 模板的语法不同</p>
<ul>
<li>React 是通过JSX渲染模板</li>
<li>而Vue是通过一种拓展的HTML语法进行渲染</li>
</ul>
<p>但其实这只是表面现象，毕竟React并不必须依赖JSX。在深层上，模板的原理不同，这才是他们的本质区别：</p>
<ul>
<li>React是在组件JS代码中，通过原生JS实现模板中的常见语法，比如插值，条件，循环等，都是通过JS语法实现的</li>
<li>Vue是在和组件JS代码分离的单独的模板中，通过指令来实现的，比如条件语句就需要 v-if 来实现</li>
</ul>
<p><strong>4、Vuex 和 Redux 的区别</strong></p>
<p>从表面上来说，store 注入和使用方式有一些区别。</p>
<p>在 Vuex 中，$store 被直接注入到了组件实例中，因此可以比较灵活的使用：</p>
<ul>
<li>使用 dispatch 和 commit 提交更新</li>
<li>通过 mapState 或者直接通过 this.$store 来读取数据</li>
</ul>
<p>在 Redux 中，我们每一个组件都需要显示的用 connect 把需要的 props 和 dispatch 连接起来。</p>
<p>另外 Vuex 更加灵活一些，组件中既可以 dispatch action 也可以 commit reducer，而 Redux 中只能进行 dispatch，并不能直接调用 reducer 进行修改。</p>
<p>从实现原理上来说，最大的区别是两点：</p>
<ul>
<li>Redux 使用的是不可变数据，而Vuex的数据是可变的。Redux每次都是用新的state替换旧的state，而Vuex是直接修改</li>
<li>Redux 在检测数据变化的时候，是比较对象的引用地址；而Vuex其实和Vue的原理一样，是通过 getter/setter来比较的（如果看Vuex源码会知道，其实他内部直接创建一个Vue实例用来跟踪数据变化）</li>
</ul>
<p><strong>5、总结</strong></p>
<p>React更偏向于构建稳定大型的应用，非常的科班化。相比之下，Vue更偏向于简单迅速的解决问题，更灵活，不那么严格遵循条条框框。因此也会给人一种大型项目用React，小型项目用 Vue 的感觉。</p>
<h2 id="1-4-React中几个核心的概念"><a href="#1-4-React中几个核心的概念" class="headerlink" title="1.4 React中几个核心的概念"></a>1.4 React中几个核心的概念</h2><h3 id="1-4-1-虚拟DOM（Virtual-Document-Object-Model）"><a href="#1-4-1-虚拟DOM（Virtual-Document-Object-Model）" class="headerlink" title="1.4.1 虚拟DOM（Virtual Document Object Model）"></a>1.4.1 虚拟DOM（Virtual Document Object Model）</h3><ul>
<li><strong>DOM的本质是什么</strong>：浏览器中的概念，用JS对象来表示页面上的元素，并提供了操作 DOM 对象的API；</li>
<li><strong>什么是React中的虚拟DOM</strong>：是框架中的概念，是程序员用JS对象来模拟页面上的 DOM 和 DOM嵌套；</li>
<li><strong>为什么要实现虚拟DOM（虚拟DOM的目的）：</strong>为了实现页面中DOM 元素的高效更新</li>
<li><strong>DOM和虚拟DOM的区别</strong>：</li>
</ul>
<p><img src="https://i.loli.net/2020/11/09/qZjtGbKpcm2eIxW.png" alt="虚拟DOM的概念.png"></p>
<p><img src="https://i.loli.net/2020/11/09/Z6YObrACqSlG5if.png" alt="1552877849641.png"></p>
<h3 id="1-4-2-react的Diff算法-Reconciliation"><a href="#1-4-2-react的Diff算法-Reconciliation" class="headerlink" title="1.4.2 react的Diff算法(Reconciliation)"></a>1.4.2 react的Diff算法(Reconciliation)</h3><p><img src="https://i.loli.net/2020/11/09/r7gyDbEYfUIXaW9.png" alt="Diff.png"></p>
<p>其实传统diff算法就是对每个节点一一对比，循环遍历所有的子节点，然后判断子节点的更新状态。通过循环递归对节点进行依次对比，算法时间复杂度达到 O(n^3) ，n是树的节点数，这个有多可怕呢？——如果要展示1000个节点，得执行上亿次比较。即便是CPU快能执行30亿条命令，也<strong>很难在一秒内</strong>计算出差异。</p>
<p>React 通过制定大胆的策略，将 O(n^3) 复杂度的问题转换成 O(n) 复杂度的问题。react根据自己的特点，实现了部分代码的简化。</p>
<p><img src="https://i.loli.net/2020/11/09/47Ig31tUxOiHLGh.png" alt="1552878167661"></p>
<h4 id="a-tree-diff"><a href="#a-tree-diff" class="headerlink" title="a) tree diff"></a>a) tree diff</h4><blockquote>
<p>（1）React通过updateDepth对Virtual DOM树进行层级控制。<br>（2）对树分层比较，两棵树只对同一层次节点进行比较。如果该节点不存在时，则该节点及其子节点会被完全删除，不会再进一步比较。<br>（3）只需遍历一次就能完成整棵DOM树的比较。</p>
</blockquote>
<p><img src="https://i.loli.net/2020/11/09/zZOVt1Gefn6oiAN.png" alt="1562723697592.png"></p>
<blockquote>
<p>那么问题来了，如果DOM节点出现了跨层级操作,diff会咋办呢？<br>答：diff只简单考虑同层级的节点位置变换，如果是跨层级的话，只有创建节点和删除节点的操作。</p>
</blockquote>
<p><img src="https://i.loli.net/2020/11/09/9vtH3A8sDhYj6ql.png" alt="1562723819718.png"></p>
<blockquote>
<p>如上图所示，以A为根节点的整棵树会被<strong>重新创建，而不是移动</strong>，因此 <strong>官方建议不要进行DOM节点跨层级操作，可以通过CSS隐藏、显示节点，而不是真正地移除、添加DOM节点</strong>。</p>
</blockquote>
<h4 id="b-component-diff"><a href="#b-component-diff" class="headerlink" title="b) component diff"></a>b) component diff</h4><p>React应用是基于组件构建的，对于组件的比较优化侧重于以下几点：</p>
<blockquote>
<ol>
<li>同一类型组件遵从tree diff比较v-dom树</li>
<li>不同类型组件，先将该组件归类为dirty component，替换下整个组件下的所有子节点</li>
<li>同一类型组件Virtual Dom没有变化，React允许开发者使用shouldComponentUpdate()来判断该组件是否进行diff，运用得当可以节省diff计算时间，提升性能</li>
</ol>
</blockquote>
<p><img src="https://i.loli.net/2020/11/09/mLuOh1tHqUVecZI.png" alt="1562723945651.png"></p>
<p>如上图，当组件D → 组件G时，diff判断为不同类型的组件，虽然它们的结构相似甚至一样，diff仍然不会比较二者结构，会直接销毁D及其子节点，然后新建一个G相关的子tree，这显然会影响性能，官方虽然认定这种情况极少出现，但是开发中的这种现象造成的影响是非常大的。</p>
<h4 id="c-element-diff"><a href="#c-element-diff" class="headerlink" title="c) element diff"></a>c) element diff</h4><p>对于同一层级的element节点，diff提供了以下3种节点操作：</p>
<blockquote>
<ol>
<li>INSERT_MARKUP 插入节点</li>
<li>MOVE_EXISING 移动节点</li>
<li>REMOVE_NODE 移除节点</li>
</ol>
</blockquote>
<p><img src="https://i.loli.net/2020/11/09/QbwmHxGfaSIkZzg.png" alt="1562724094202.png"></p>
<p>一般diff在比较集合[A,B,C,D]和[B，A，D，C]的时候会进行全部对比，即按对应位置逐个比较，发现每个位置对应的元素都有所更新，则把旧集合全部移除，替换成新的集合，如上图，但是这样的操作在React中显然是复杂、低效、影响性能的操作，因为新集合中所有的元素都可以进行复用，无需删除重新创建，耗费性能和内存，只需要移动元素位置即可。</p>
<p>React对这一现象做出了一个高效的策略：允许开发者对同一层级的同组子节点添加唯一key值进行区分。意义就是代码上的一小步，性能上的一大步，甚至是翻天覆地的变化！</p>
<h1 id="2-Create-React-App脚手架"><a href="#2-Create-React-App脚手架" class="headerlink" title="2. Create React App脚手架"></a>2. Create React App脚手架</h1><p><a target="_blank" rel="noopener" href="https://www.html.cn/create-react-app/docs/getting-started/">https://www.html.cn/create-react-app/docs/getting-started/</a></p>
<p><code>Create React App</code>是FaceBook的React团队官方出的一个构建<code>React</code>单页面应用的脚手架工具。它本身集成了<code>Webpack</code>，并配置了一系列内置的<code>loader</code>和默认的npm的脚本，可以很轻松的实现零配置就可以快速开发React的应用。</p>
<h2 id="2-1-创建应用"><a href="#2-1-创建应用" class="headerlink" title="2.1 创建应用"></a>2.1 创建应用</h2><pre class=" language-js"><code class="language-js"># 全局安装
npm install <span class="token operator">-</span>g create<span class="token operator">-</span>react<span class="token operator">-</span>app
# 构建一个my<span class="token operator">-</span>app的项目
npx create<span class="token operator">-</span>react<span class="token operator">-</span>app my<span class="token operator">-</span>app                     
npx create<span class="token operator">-</span>react<span class="token operator">-</span>app my<span class="token operator">-</span>test<span class="token operator">-</span>app <span class="token operator">--</span>template typescript    <span class="token comment" spellcheck="true">//typescript版本</span>
cd my<span class="token operator">-</span>app

# 启动编译当前的React项目，并自动打开 http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token punctuation">:</span><span class="token number">3000</span><span class="token operator">/</span>
yarn start

# 如果你不能确保最新版本，可以先尝试卸载： npm uninstall <span class="token operator">-</span>g create<span class="token operator">-</span>react<span class="token operator">-</span>app<span class="token punctuation">,</span>然后再全局安装

# 解压默认的webpack配置到配置文件中
# react<span class="token operator">-</span>scripts 是 create<span class="token operator">-</span>react<span class="token operator">-</span>app 的一个核心包，一些脚本和工具的默认配置都集成在里面，而 yarn eject 命令执行后会将封装在 create<span class="token operator">-</span>react<span class="token operator">-</span>app 中的配置全部反编译到当前项目，这样用户就能完全取得 webpack 文件的控制权。所以，eject 命令存在的意义就是更改 webpack 配置存在的啊！
yarn run eject
yarn install   <span class="token comment" spellcheck="true">//需要再次运行install命令安装</span>
yarn run start <span class="token comment" spellcheck="true">//然后才可以启动</span></code></pre>
<p>应用的目录结构：</p>
<pre class=" language-js"><code class="language-js">├── <span class="token keyword">package</span><span class="token punctuation">.</span>json
├── <span class="token keyword">public</span>                  # 这个是webpack的配置的静态目录
│   ├── favicon<span class="token punctuation">.</span>ico
│   ├── index<span class="token punctuation">.</span>html          # 默认是单页面应用，这个是最终的html的基础模板
│   └── manifest<span class="token punctuation">.</span>json
├── src
│   ├── App<span class="token punctuation">.</span>css             # App根组件的css
│   ├── App<span class="token punctuation">.</span>tsx              # App组件代码
│   ├── App<span class="token punctuation">.</span>test<span class="token punctuation">.</span>tsx
│   ├── index<span class="token punctuation">.</span>css           # 启动文件样式
│   ├── index<span class="token punctuation">.</span>tsx            # 启动的文件（开始执行的入口）！！！！
│   ├── logo<span class="token punctuation">.</span>svg
│   └── serviceWorker<span class="token punctuation">.</span>js
└── yarn<span class="token punctuation">.</span>lock</code></pre>
<h2 id="2-2-添加图片，字体和文件"><a href="#2-2-添加图片，字体和文件" class="headerlink" title="2.2 添加图片，字体和文件"></a>2.2 添加图片，字体和文件</h2><p>使用 Webpack，添加图片和字体等静态资源的工作方式与 CSS 类似。</p>
<p>你可以 <strong>直接在 JavaScript 模块中 import 文件</strong>。 这会告诉 Webpack 将该文件包含在 bundle(包) 中。 与 CSS 导入不同，导入文件会为你提供字符串值。 此值是你可以在代码中引用的最终路径，例如 image 的 <code>src</code> 属性或链接到 PDF 的 <code>href</code> 属性。</p>
<p>要减少对服务器的请求数，导入小于 10,000 字节的图片将返回 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URIs">data URI</a> 而不是路径。 这适用于以下文件扩展名：<code>bmp</code> ，<code>gif</code> ，<code>jpg</code> ，<code>jpeg</code> 和 <code>png</code> 。</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">//例如：</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> logo <span class="token keyword">from</span> <span class="token string">'./logo.png'</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 告诉 Webpack 这个 JS 文件使用了这个图片</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>logo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// /logo.84287d09.png</span>

<span class="token keyword">function</span> <span class="token function">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// 导入结果是图片的 URL </span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token punctuation">{</span>logo<span class="token punctuation">}</span> alt<span class="token operator">=</span><span class="token string">"Logo"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Header<span class="token punctuation">;</span></code></pre>
<pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//这也适用于 CSS ：</span>
<span class="token punctuation">.</span>Logo <span class="token punctuation">{</span>
  background<span class="token operator">-</span>image<span class="token punctuation">:</span> <span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">/</span>logo<span class="token punctuation">.</span>png<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">//字体图标的使用</span>
<span class="token comment" spellcheck="true">//yarn add font-awesome</span>
<span class="token comment" spellcheck="true">//引入样式</span>
<span class="token keyword">import</span> <span class="token string">'font-awesome/css/font-awesome.css'</span>
<span class="token comment" spellcheck="true">//使用样式</span>
<span class="token operator">&lt;</span>i <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"fa fa-address-book"</span> aria<span class="token operator">-</span>hidden<span class="token operator">=</span><span class="token string">"true"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">></span> 

<span class="token comment" spellcheck="true">//具体使用参照官网：http://www.fontawesome.com.cn/faicons/</span></code></pre>
<h2 id="2-3-修改默认配置"><a href="#2-3-修改默认配置" class="headerlink" title="2.3 修改默认配置"></a>2.3 修改默认配置</h2><p>要修改 create-react-app 脚手架中的默认配置，正常情况下我们也不会通过yarn reject暴露配置文件然后修改配置文件，我们可以在项目根目录下新建一个config-overrides.js配置文件，覆盖默认的配置</p>
<pre class=" language-jsx"><code class="language-jsx"><span class="token number">1</span><span class="token punctuation">.</span>    yarn add react<span class="token operator">-</span>app<span class="token operator">-</span>rewired customize<span class="token operator">-</span>cra
<span class="token number">2</span><span class="token punctuation">.</span>    在项目根目录下创建一个config<span class="token operator">-</span>overrides<span class="token punctuation">.</span>js
<span class="token number">3</span><span class="token punctuation">.</span>  修改<span class="token keyword">package</span><span class="token punctuation">.</span>json
    <span class="token string">"scripts"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token operator">-</span> <span class="token string">"start"</span><span class="token punctuation">:</span> <span class="token string">"react-scripts start"</span><span class="token punctuation">,</span>
        <span class="token operator">+</span> <span class="token string">"start"</span><span class="token punctuation">:</span> <span class="token string">"react-app-rewired start"</span><span class="token punctuation">,</span>
        <span class="token operator">-</span> <span class="token string">"build"</span><span class="token punctuation">:</span> <span class="token string">"react-scripts build"</span><span class="token punctuation">,</span>
        <span class="token operator">+</span> <span class="token string">"build"</span><span class="token punctuation">:</span> <span class="token string">"react-app-rewired build"</span><span class="token punctuation">,</span>
        <span class="token operator">-</span> <span class="token string">"test"</span><span class="token punctuation">:</span> <span class="token string">"react-scripts test"</span><span class="token punctuation">,</span>
        <span class="token operator">+</span> <span class="token string">"test"</span><span class="token punctuation">:</span> <span class="token string">"react-app-rewired test"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//  修改config-overrides.js文件</span>
<span class="token comment" spellcheck="true">//  http://npm.taobao.org/package/customize-cra</span>
<span class="token comment" spellcheck="true">//  https://blog.csdn.net/weixin_33850890/article/details/91372527</span>


<span class="token comment" spellcheck="true">// 配置less和@符号</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>
    override<span class="token punctuation">,</span>
    addWebpackAlias
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"customize-cra"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">override</span><span class="token punctuation">(</span>
    <span class="token function">addWebpackAlias</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token string">"@"</span><span class="token punctuation">]</span><span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"src"</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<pre class=" language-json"><code class="language-json">//在项目根目录下创建paths.json
<span class="token punctuation">{</span>
    <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"baseUrl"</span><span class="token operator">:</span> <span class="token string">"."</span><span class="token punctuation">,</span>
        <span class="token property">"paths"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"@/*"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"src/*"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">"@components/*"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"src/components/*"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">"@pages/*"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"src/pages/*"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">"@utils/*"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"src/utils/*"</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

//修改tsconfig.json
<span class="token punctuation">{</span>
    <span class="token property">"extends"</span><span class="token operator">:</span> <span class="token string">"./paths.json"</span><span class="token punctuation">,</span>
    <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h2 id="2-4-React基本语法"><a href="#2-4-React基本语法" class="headerlink" title="2.4 React基本语法"></a>2.4 React基本语法</h2><h3 id="2-4-1-React的核心包"><a href="#2-4-1-React的核心包" class="headerlink" title="2.4.1 React的核心包"></a>2.4.1 React的核心包</h3><ul>
<li>react： 专门用于创建组件和虚拟DOM的，同时组件的生命周期都在这个包中</li>
<li>react-dom： 专门进行DOM操作的，最主要的应用场景，就是<code>ReactDOM.render()</code></li>
</ul>
<pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// 这是 创建虚拟DOM元素的 API    &lt;h1 title="啊，五环" id="myh1">你比四环多一环&lt;/h1></span>
<span class="token comment" spellcheck="true">//  第一个参数： 字符串类型的参数，表示要创建的标签的名称</span>
<span class="token comment" spellcheck="true">//  第二个参数：对象类型的参数， 表示 创建的元素的属性节点</span>
<span class="token comment" spellcheck="true">//  第三个参数： 子节点（包括 其它 虚拟DOM 获取 文本子节点）</span>
<span class="token comment" spellcheck="true">//  参数n :  其它子节点</span>
<span class="token keyword">const</span> myh1 <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">'啊，五环'</span><span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token string">'myh1'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'你比四环多一环'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> mydiv <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'这是一个div元素'</span><span class="token punctuation">,</span> myh1<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// 3. 渲染虚拟DOM元素</span>
<span class="token comment" spellcheck="true">// 参数1： 表示要渲染的虚拟DOM对象</span>
<span class="token comment" spellcheck="true">// 参数2： 指定容器,注意：这里不能直接放 容器元素的Id字符串，需要放一个容器的DOM对象</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>myh1<span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<h3 id="2-4-2-JSX语法"><a href="#2-4-2-JSX语法" class="headerlink" title="2.4.2 JSX语法"></a>2.4.2 JSX语法</h3><blockquote>
<p>什么是JSX语法：就是符合 xml 规范的 JS 语法；（语法格式相对来说，要比HTML严谨很多）</p>
</blockquote>
<p>JSX语法的本质：并不是直接把 jsx 渲染到页面上，而是内部通过 createElement 再渲染到页面；</p>
<p>在 jsx 中混合写入 js 表达式：在 jsx 语法中，要把 JS代码写到    <code>{ }</code> 中</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// 1. 导入包</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span>

<span class="token comment" spellcheck="true">//2. JSX中使用数值、字符串、bool、数组等信息</span>
<span class="token keyword">let</span> a<span class="token punctuation">:</span>number <span class="token operator">=</span> <span class="token number">10</span>
<span class="token keyword">let</span> str<span class="token punctuation">:</span>string <span class="token operator">=</span> <span class="token string">'你好，中国'</span>
<span class="token keyword">let</span> boo<span class="token punctuation">:</span>boolean <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token keyword">let</span> title<span class="token punctuation">:</span>string <span class="token operator">=</span> <span class="token string">'999'</span>
<span class="token keyword">const</span> h1<span class="token punctuation">:</span>JSX<span class="token punctuation">.</span>Element <span class="token operator">=</span> <span class="token operator">&lt;</span>h1<span class="token operator">></span>红火火恍恍惚惚<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
<span class="token keyword">const</span> arr<span class="token punctuation">:</span>JSX<span class="token punctuation">.</span>Element<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token operator">&lt;</span>h2<span class="token operator">></span>这是h2<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span><span class="token punctuation">,</span>
  <span class="token operator">&lt;</span>h3<span class="token operator">></span>这是h3<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span>
<span class="token punctuation">]</span>
<span class="token keyword">const</span> arrStr<span class="token punctuation">:</span>string<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'毛利兰'</span><span class="token punctuation">,</span> <span class="token string">'柯南'</span><span class="token punctuation">,</span> <span class="token string">'小五郎'</span><span class="token punctuation">,</span> <span class="token string">'灰原哀'</span><span class="token punctuation">]</span>

<span class="token comment" spellcheck="true">// 定义一个空数组，将来用来存放 名称 标签【方案1】</span>
<span class="token keyword">const</span> nameArr<span class="token punctuation">:</span>JSX<span class="token punctuation">.</span>Element<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true">// 注意： React 中，需要把 key 添加给 被 forEach 或 map 或 for 循环直接控制的元素</span>
arrStr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>item <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> temp <span class="token operator">=</span> <span class="token operator">&lt;</span>h5 key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h5<span class="token operator">></span>
  nameArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// 数组的 map 方法, map 中必须写 return</span>
<span class="token keyword">const</span> result<span class="token punctuation">:</span>string<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> arrStr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> item <span class="token operator">+</span> <span class="token string">'~~'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> 

<span class="token comment" spellcheck="true">// 3. 调用 render 函数渲染   JSX  XML 比 HTML 严格多了</span>
<span class="token comment" spellcheck="true">// 在JSX要使用JS，则需要把 JS 代码写到 {} 中</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>div<span class="token operator">></span>
  <span class="token punctuation">{</span>a <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">}</span>
  <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">{</span>str<span class="token punctuation">}</span>
  <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">{</span>boo <span class="token operator">?</span> <span class="token string">'条件为真'</span> <span class="token punctuation">:</span> <span class="token string">'条件为假'</span><span class="token punctuation">}</span>
  <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&lt;</span>p title<span class="token operator">=</span><span class="token punctuation">{</span>title<span class="token punctuation">}</span><span class="token operator">></span>这是p标签<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
  <span class="token punctuation">{</span>h1<span class="token punctuation">}</span>
  <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">{</span><span class="token comment" spellcheck="true">/* {arr} */</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 这是注释，你看不见我</span>
  <span class="token punctuation">}</span>
  <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">{</span>nameArr<span class="token punctuation">}</span>
  <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">{</span>arrStr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&lt;</span>div key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span>h3<span class="token operator">></span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">}</span>
  <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">></span>

  <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">"ooo"</span><span class="token operator">></span><span class="token number">11111</span><span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


 #注意点：
<span class="token number">1</span><span class="token punctuation">.</span> 在 JSX 中 写注释：推荐使用<span class="token punctuation">{</span> <span class="token comment" spellcheck="true">/* 这是注释 */</span> <span class="token punctuation">}</span>
<span class="token number">2</span><span class="token punctuation">.</span> 为 JSX 中的htmlFor替换label的<span class="token keyword">for</span>属性
<span class="token number">3</span><span class="token punctuation">.</span> 在 JSX 创建DOM的时候，所有的节点，必须有唯一的根元素进行包裹；
<span class="token number">4</span><span class="token punctuation">.</span> 在 JSX 语法中，标签必须成对出现，如果是单标签，则必须自闭和！</code></pre>
<blockquote>
<p>当 编译引擎，在编译JSX代码的时候，如果遇到了<code>&lt;</code>那么就把它当作 HTML代码去编译，如果遇到了 <code>{}</code> 就把 花括号内部的代码当作普通JS代码去编译；</p>
</blockquote>
<h1 id="3-React中创建组件"><a href="#3-React中创建组件" class="headerlink" title="3. React中创建组件"></a>3. React中创建组件</h1><h2 id="3-1-使用-class-关键字来创建组件"><a href="#3-1-使用-class-关键字来创建组件" class="headerlink" title="3.1 使用 class 关键字来创建组件"></a>3.1 使用 class 关键字来创建组件</h2><h3 id="3-1-1-最基本的组件结构"><a href="#3-1-1-最基本的组件结构" class="headerlink" title="3.1.1 最基本的组件结构"></a>3.1.1 最基本的组件结构</h3><pre class=" language-jsx"><code class="language-jsx"><span class="token comment" spellcheck="true">//让自己的组件继承React.Compoent，重写render方法</span>
<span class="token keyword">class</span> 组件名称 <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>这是 <span class="token keyword">class</span> 创建的组件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="3-1-2-使用案例"><a href="#3-1-2-使用案例" class="headerlink" title="3.1.2 使用案例"></a>3.1.2 使用案例</h3><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//新建Movie.tsx</span>

<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//只读 不可以修改</span>
type IProps <span class="token operator">=</span> Readonly<span class="token operator">&lt;</span><span class="token punctuation">{</span>
  name<span class="token operator">?</span><span class="token punctuation">:</span> string<span class="token punctuation">;</span>
  age<span class="token operator">?</span><span class="token punctuation">:</span> number<span class="token punctuation">;</span>
  gender<span class="token operator">?</span><span class="token punctuation">:</span> string<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">;</span>

<span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span> msg<span class="token punctuation">:</span> <span class="token string">'大家好，我是 class 创建的 Movie组件'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//只读 不可以this.state来修改</span>
type IState <span class="token operator">=</span> Readonly<span class="token operator">&lt;</span><span class="token keyword">typeof</span> initialState<span class="token operator">></span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//创建一个类继承React.component   </span>
<span class="token comment" spellcheck="true">//&lt;IProps，IState>是泛型，约定组件中的props和state的类型</span>
<span class="token keyword">class</span> <span class="token class-name">Movie</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token operator">&lt;</span>IProps<span class="token punctuation">,</span> IState<span class="token operator">></span> <span class="token punctuation">{</span>
  readonly state<span class="token punctuation">:</span> IState <span class="token operator">=</span> initialState<span class="token punctuation">;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token punctuation">{</span><span class="token comment" spellcheck="true">/* 注意：在 class 组件内部，this 表示 当前组件的实例对象。props数据不可以修改，state数据可以修改 */</span><span class="token punctuation">}</span>
      这是 Movie 组件 <span class="token operator">--</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>name<span class="token punctuation">}</span> <span class="token operator">--</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>age<span class="token punctuation">}</span> <span class="token operator">--</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>gender<span class="token punctuation">}</span>
      <span class="token operator">&lt;</span>h3<span class="token operator">></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>msg<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Movie<span class="token punctuation">;</span></code></pre>
<pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//index.tsx</span>
<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'zs'</span><span class="token punctuation">,</span>
  age<span class="token punctuation">:</span> <span class="token number">22</span><span class="token punctuation">,</span>
  gender<span class="token punctuation">:</span> <span class="token string">'男'</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 3. 调用 render 函数渲染</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>div<span class="token operator">></span>
  <span class="token number">123</span>
  <span class="token punctuation">{</span><span class="token comment" spellcheck="true">/* 这里的 Movie 标签，其实，就是 Movie 类的一个实例对象 */</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token comment" spellcheck="true">/* &lt;Movie name={user.name} age={user.age}>&lt;/Movie> */</span><span class="token punctuation">}</span>
  <span class="token operator">&lt;</span>Movie <span class="token punctuation">{</span><span class="token operator">...</span>user<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Movie<span class="token operator">></span>

<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<h3 id="3-1-3-state的修改"><a href="#3-1-3-state的修改" class="headerlink" title="3.1.3 state的修改"></a>3.1.3 state的修改</h3><h4 id="a-不能直接修改-State"><a href="#a-不能直接修改-State" class="headerlink" title="a) 不能直接修改 State"></a>a) 不能直接修改 State</h4><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//我们把state设置为Readonly就是为了不让直接修改state，所以下面写法错误</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>comment <span class="token operator">=</span> <span class="token string">'Hello'</span><span class="token punctuation">;</span>

 <span class="token comment" spellcheck="true">//可以这样修改State</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>comment<span class="token punctuation">:</span> <span class="token string">'Hello'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="b-State的更新可能是异步的"><a href="#b-State的更新可能是异步的" class="headerlink" title="b) State的更新可能是异步的"></a>b) State的更新可能是异步的</h4><p>因为 <code>this.props</code> 和 <code>this.state</code> 可能会异步更新，所以你不要依赖他们的值来更新下一个状态。</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//调用setState，组件的state并不会立即改变，setState只是把要修改的状态放入一个队列中，React会优化真正的执行时机，并且React会出于性能原因，可能会将多次setState的状态修改合并成一次状态修改。所以不要依赖当前的State，计算下个State。</span>
<span class="token keyword">private</span> btnAdd <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">//Wrong</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>count<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>count<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>count<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">//结果state的count为1</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// Wrong   因为state和props的更新可能是异步的，所以并不能保证counter中所获取到的state和props是最新的</span>
<span class="token keyword">private</span> btnAdd <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      counter<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>counter <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>increment<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//Correct</span>
 <span class="token keyword">private</span> btnAdd <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span>state<span class="token punctuation">:</span>IState<span class="token punctuation">,</span>props<span class="token punctuation">:</span>IProps<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      count<span class="token punctuation">:</span>state<span class="token punctuation">.</span>count<span class="token operator">+</span><span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span>state<span class="token punctuation">:</span>IState<span class="token punctuation">,</span>props<span class="token punctuation">:</span>IProps<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      count<span class="token punctuation">:</span>state<span class="token punctuation">.</span>count<span class="token operator">+</span><span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span>state<span class="token punctuation">:</span>IState<span class="token punctuation">,</span>props<span class="token punctuation">:</span>IProps<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      count<span class="token punctuation">:</span>state<span class="token punctuation">.</span>count<span class="token operator">+</span><span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span></code></pre>
<blockquote>
<p>state的更新既可能是同步的，也可能是异步的。 准确地说，在React内部机制能检测到的地方, setState就是异步的；在React检测不到的地方，例如setInterval、setTimeout里，setState就是同步更新的。</p>
</blockquote>
<h4 id="c-获取更新之后的state数据"><a href="#c-获取更新之后的state数据" class="headerlink" title="c) 获取更新之后的state数据"></a>c) 获取更新之后的state数据</h4><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span> data<span class="token punctuation">:</span> newData <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//这里打印的是最新的state值</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="d-setState合并"><a href="#d-setState合并" class="headerlink" title="d) setState合并"></a>d) setState合并</h4><pre class=" language-typescript"><code class="language-typescript"><span class="token comment" spellcheck="true">//setState会把当前的值合并到原来的state中</span>
<span class="token comment" spellcheck="true">//只要调用一次setState就会触发页面的重新渲染，不管这个state在页面有没有使用过，也不管这个state有没有发生变化</span>
<span class="token comment" spellcheck="true">//为什么setState会触发页面的重新渲染呢？  因为setState内容会触发batchingUpdate方法来触发组件更新</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token punctuation">:</span><span class="token string">"王小虎"</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<h4 id="e-setState的实现过程"><a href="#e-setState的实现过程" class="headerlink" title="e) setState的实现过程"></a>e) setState的实现过程</h4><p><img src="https://i.loli.net/2020/11/09/mCiq6G274oUYIAr.png" alt="3941614716-5b13d6d716035_articlex.png"></p>
<h2 id="3-2-使用构造函数来创建组件"><a href="#3-2-使用构造函数来创建组件" class="headerlink" title="3.2 使用构造函数来创建组件"></a>3.2 使用构造函数来创建组件</h2><h3 id="3-2-1-基本使用"><a href="#3-2-1-基本使用" class="headerlink" title="3.2.1 基本使用"></a>3.2.1 基本使用</h3><pre class=" language-javascript"><code class="language-javascript">#<span class="token number">1</span><span class="token punctuation">.</span> 新建Hello<span class="token punctuation">.</span>tsx，并导出组件
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> MouseEvent<span class="token punctuation">,</span> FC <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

type Props <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">?</span><span class="token punctuation">:</span> string<span class="token punctuation">;</span>
  age<span class="token operator">?</span><span class="token punctuation">:</span> number<span class="token punctuation">;</span>
  gender<span class="token operator">?</span><span class="token punctuation">:</span> string<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> Hello<span class="token punctuation">:</span> FC<span class="token operator">&lt;</span>Props<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// 如果 在一个组件中 return 一个 null。则表示此组件是空的，什么都不会渲染</span>
  <span class="token comment" spellcheck="true">// return null</span>
  <span class="token comment" spellcheck="true">// 在组件中，必须 返回一个 合法的 JSX 虚拟DOM元素</span>
  <span class="token comment" spellcheck="true">// props.name = 'zs'</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token comment" spellcheck="true">// 结论：不论是 Vue 还是 React，组件中的 props 永远都是只读的；不能被重新赋值；</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span>这是 Hello 组件 <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">{</span>props<span class="token punctuation">.</span>name<span class="token punctuation">}</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">{</span>props<span class="token punctuation">.</span>age<span class="token punctuation">}</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">{</span>props<span class="token punctuation">.</span>gender<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Hello<span class="token punctuation">;</span>


#<span class="token number">2</span><span class="token punctuation">.</span>导入Hello<span class="token punctuation">.</span>jsx
  <span class="token comment" spellcheck="true">// 1. 导入包</span>
  <span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
  <span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span>
  <span class="token comment" spellcheck="true">// 注意： 这里的 @ 符号，表示 项目根目录中的 src 这一层目录</span>
  <span class="token keyword">import</span> Hello <span class="token keyword">from</span> <span class="token string">'@/components/Hello.jsx'</span>
  <span class="token keyword">const</span> dog <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'大黄'</span><span class="token punctuation">,</span>
    age<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    gender<span class="token punctuation">:</span> <span class="token string">'雄'</span>
  <span class="token punctuation">}</span>

  ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>div<span class="token operator">></span>
    <span class="token number">123</span>
    <span class="token operator">&lt;</span>Hello <span class="token punctuation">{</span><span class="token operator">...</span>dog<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Hello<span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<h3 id="3-2-2-函数组件中的state"><a href="#3-2-2-函数组件中的state" class="headerlink" title="3.2.2 函数组件中的state"></a>3.2.2 函数组件中的state</h3><blockquote>
<p>React 16.7.0开始推行Hook，到 React 16.8.0 Hook 稳定，Hooks开始被推广使用，它解决了传统使用生命周期而导致的相关代码逻辑分离(例如创建订阅及取消订阅)、不相关代码逻辑混合在一个生命周期中(使用多个Effect)、class中复杂的this指向、class不能被很好的压缩、class可能导致热重载不稳定</p>
</blockquote>
<blockquote>
<p>Hook为开发者提供了可以使用function创建微state，且一个state由一个对应的函数管理，还提供了专门处理副作用、实现redux、性能优化等功能，并且100%向后兼容，个人认为Hook是react未来发展的趋势，但并不意味着摒弃class，react也没有移除class的计划。</p>
</blockquote>
<p><code>useState</code> 就是一个 <em>Hook</em> ，通过在函数组件里调用它来给组件添加一些内部 state。React 会在重复渲染时保留这个 state。</p>
<p><code>useState</code> 会返回一对值：<strong>当前</strong>状态和一个让你更新它的函数，你可以在事件处理函数中或其他一些地方调用这个函数。它类似 class 组件的 <code>this.setState</code>，但是它不会把新的 state 和旧的 state 进行合并。</p>
<blockquote>
<ol>
<li><p>一般来说，一个函数组件，在函数退出后变量就会”消失”，但是 state 中的变量会被 React 保留。</p>
</li>
<li><p>当我们点击按钮，调用setCount函数时，React会重新渲染这个组件，并把更新的count值传给这个组件。(其实是每次 Render 都有自己的 Props 与 State)</p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000018639033#item-2-5">https://segmentfault.com/a/1190000018639033#item-2-5</a></p>
</li>
<li><p>useState()接受一个参数为默认值，该方法返回一个数组，第一个值为定义data的值，第二个为更新data的方法，他们总是成对出现的</p>
</li>
</ol>
</blockquote>
<h3 id="3-2-3-state-hook基本使用"><a href="#3-2-3-state-hook基本使用" class="headerlink" title="3.2.3  state hook基本使用"></a>3.2.3  state hook基本使用</h3><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

type Props <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> Demo1<span class="token punctuation">:</span> FC<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Props</span><span class="token punctuation">></span></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">//count代表state的变量</span>
  <span class="token comment" spellcheck="true">//setCount是一个function，如果我们要修改count变量，需要通过setCount来修改</span>
  <span class="token keyword">let</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> useState<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> <span class="token punctuation">[</span>count2<span class="token punctuation">,</span> setCount2<span class="token punctuation">]</span> <span class="token operator">=</span> useState<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> <span class="token punctuation">[</span>count3<span class="token punctuation">,</span> setCount3<span class="token punctuation">]</span> <span class="token operator">=</span> useState<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>
    <span class="token punctuation">{</span>count<span class="token punctuation">}</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span> <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token operator">++</span>count<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span>点我修改count<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span>
    <span class="token punctuation">{</span>count2<span class="token punctuation">}</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span> <span class="token function">setCount2</span><span class="token punctuation">(</span><span class="token operator">++</span>count2<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span>点我修改count2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span>
    <span class="token punctuation">{</span>count3<span class="token punctuation">}</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span> <span class="token function">setCount3</span><span class="token punctuation">(</span><span class="token operator">++</span>count3<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span>点我修改count3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Demo1<span class="token punctuation">;</span></code></pre>
<h3 id="3-2-4-useState使用注意点"><a href="#3-2-4-useState使用注意点" class="headerlink" title="3.2.4 useState使用注意点"></a>3.2.4 useState使用注意点</h3><h4 id="a-useState是异步的"><a href="#a-useState是异步的" class="headerlink" title="a) useState是异步的"></a>a) <code>useState</code>是异步的</h4><p>修改state之后无法拿到最新的状态，要等到下一个事件循环周期执行时，状态才是最新的</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> Demo1<span class="token punctuation">:</span> FC<span class="token operator">&lt;</span>Props<span class="token operator">></span> <span class="token operator">=</span> props <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>people<span class="token punctuation">,</span> setPeople<span class="token punctuation">]</span> <span class="token operator">=</span> useState<span class="token operator">&lt;</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> string<span class="token punctuation">,</span> age<span class="token punctuation">:</span> number <span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">"张三"</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">12</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> handleUpdate <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token function">setPeople</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>people<span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'王五'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>people<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 张三</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>div<span class="token operator">></span>
    <span class="token punctuation">{</span>people<span class="token punctuation">.</span>name<span class="token punctuation">}</span>
    <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleUpdate<span class="token punctuation">}</span><span class="token operator">></span> 修改name<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Demo1<span class="token punctuation">;</span></code></pre>
<p>但是在state不影响DOM的前提下，你是可以同步使用它</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

type Props <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> Demo1<span class="token punctuation">:</span> FC<span class="token operator">&lt;</span>Props<span class="token operator">></span> <span class="token operator">=</span> props <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>people<span class="token punctuation">,</span> setPeople<span class="token punctuation">]</span> <span class="token operator">=</span> useState<span class="token operator">&lt;</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> string<span class="token punctuation">,</span> age<span class="token punctuation">:</span> number <span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">"张三"</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">12</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> handleUpdate <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token function">setPeople</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>people<span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'王五'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    people<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"王五"</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>people<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 王五</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>div<span class="token operator">></span>
    <span class="token punctuation">{</span>people<span class="token punctuation">.</span>name<span class="token punctuation">}</span>
    <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleUpdate<span class="token punctuation">}</span><span class="token operator">></span> 修改name<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Demo1<span class="token punctuation">;</span></code></pre>
<h4 id="b-useState中的数据务必是immutable数据"><a href="#b-useState中的数据务必是immutable数据" class="headerlink" title="b) useState中的数据务必是immutable数据"></a>b) <code>useState</code>中的数据务必是<code>immutable</code>数据</h4><p>若两次传入同一对象则不会触发组件更新，如：</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

type Props <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> Demo1<span class="token punctuation">:</span> FC<span class="token operator">&lt;</span>Props<span class="token operator">></span> <span class="token operator">=</span> props <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>list<span class="token punctuation">,</span> setList<span class="token punctuation">]</span> <span class="token operator">=</span> useState<span class="token operator">&lt;</span>number<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>ul<span class="token operator">></span>
      <span class="token punctuation">{</span>list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> idx<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span><span class="token function">String</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>
    <span class="token punctuation">{</span><span class="token comment" spellcheck="true">/* sort 不生成副本，直接返回原数组 */</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span> <span class="token function">setList</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> a <span class="token operator">-</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>sort<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token punctuation">{</span><span class="token comment" spellcheck="true">/* slice 返回一个新的副本数组 */</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span> <span class="token function">setList</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> a <span class="token operator">-</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>slice<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Demo1<span class="token punctuation">;</span></code></pre>
<p>点击sort按钮后并不会出发更新！</p>
<ul>
<li><code>useState</code>对应的 setState对state地改变生效，无论DOM是否使用了<code>state</code>，该组件都会重新渲染；</li>
</ul>
<h4 id="c-useState-是将新值直接覆盖掉旧值，而不是合并"><a href="#c-useState-是将新值直接覆盖掉旧值，而不是合并" class="headerlink" title="c) useState 是将新值直接覆盖掉旧值，而不是合并"></a>c) useState 是将新值直接覆盖掉旧值，而不是合并</h4><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token punctuation">[</span>temp<span class="token punctuation">,</span>setTemp<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>a<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTemp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>a<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// temp = {a: 2}</span></code></pre>
<h2 id="3-3-两种创建组件方式的对比"><a href="#3-3-两种创建组件方式的对比" class="headerlink" title="3.3 两种创建组件方式的对比"></a>3.3 两种创建组件方式的对比</h2><ol>
<li>用<strong>构造函数</strong>创建出来的组件：叫做“无状态组件”，只有props，没有自己的私有数据和生命周期函数</li>
<li>用<strong>class关键字</strong>创建出来的组件：叫做“有状态组件”，有私有数据和生命周期函数</li>
<li>无状态组件的本质只是一个render函数，其没有实例化的过程，故而也无法访问组件对象</li>
</ol>
<blockquote>
<p>有状态组件和无状态组件之间的<strong>本质区别</strong>就是：有无state属性！无状态组件由于没有私有数据和生命周期函数，运行效率会比有状态组件高一些。</p>
<p>在react hooks中，允许我们通过useState这个hook给函数组件添加状态</p>
</blockquote>
<h2 id="3-4-条件渲染"><a href="#3-4-条件渲染" class="headerlink" title="3.4 条件渲染"></a>3.4 条件渲染</h2><h3 id="3-4-1-通过if来进行条件渲染"><a href="#3-4-1-通过if来进行条件渲染" class="headerlink" title="3.4.1 通过if来进行条件渲染"></a>3.4.1 通过if来进行条件渲染</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/crystalqy/article/details/79066347">https://blog.csdn.net/crystalqy/article/details/79066347</a></p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//Gretting.jsx</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

type Props <span class="token operator">=</span> <span class="token punctuation">{</span>
  isLoggedIn<span class="token operator">?</span><span class="token punctuation">:</span>boolean
<span class="token punctuation">}</span>

<span class="token keyword">const</span> Gretting<span class="token punctuation">:</span> FC<span class="token operator">&lt;</span>Props<span class="token operator">></span> <span class="token operator">=</span> props <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> isLoggedIn <span class="token operator">=</span> props<span class="token punctuation">.</span>isLoggedIn<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isLoggedIn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>h1<span class="token operator">></span>已登录<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>h1<span class="token operator">></span>未登录<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Gretting<span class="token punctuation">;</span>


<span class="token comment" spellcheck="true">//index.tsx</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>div<span class="token operator">></span>
  <span class="token operator">&lt;</span>Gretting isLoggedIn<span class="token operator">=</span><span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Gretting<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<h3 id="3-4-2-通过三元运算符条件渲染"><a href="#3-4-2-通过三元运算符条件渲染" class="headerlink" title="3.4.2 通过三元运算符条件渲染"></a>3.4.2 通过三元运算符条件渲染</h3><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

type Props <span class="token operator">=</span> <span class="token punctuation">{</span>
  isLoggedIn<span class="token operator">?</span><span class="token punctuation">:</span>boolean
<span class="token punctuation">}</span>

<span class="token keyword">const</span> Gretting<span class="token punctuation">:</span> FC<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Props</span><span class="token punctuation">></span></span> <span class="token operator">=</span> props <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> isLoggedIn <span class="token operator">=</span> props<span class="token punctuation">.</span>isLoggedIn<span class="token punctuation">;</span>
  <span class="token keyword">return</span> isLoggedIn<span class="token operator">?</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>已登录<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">:</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>未登录<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Gretting<span class="token punctuation">;</span></code></pre>
<h3 id="3-4-3-阻止组件渲染"><a href="#3-4-3-阻止组件渲染" class="headerlink" title="3.4.3 阻止组件渲染"></a>3.4.3 阻止组件渲染</h3><p>在极少数情况下，你可能希望能隐藏组件，即使它已经被其他组件渲染。若要完成此操作，你可以让 <code>render</code> 方法直接返回 <code>null</code>，而不进行任何渲染。</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

type Props <span class="token operator">=</span> <span class="token punctuation">{</span>
  isLoggedIn<span class="token operator">?</span><span class="token punctuation">:</span>boolean
<span class="token punctuation">}</span>

<span class="token keyword">const</span> Gretting<span class="token punctuation">:</span> FC<span class="token operator">&lt;</span>Props<span class="token operator">></span> <span class="token operator">=</span> props <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> isLoggedIn <span class="token operator">=</span> props<span class="token punctuation">.</span>isLoggedIn<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isLoggedIn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>h1<span class="token operator">></span>已登录<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Gretting<span class="token punctuation">;</span></code></pre>
<h3 id="3-4-4-通过-amp-amp-进行条件渲染"><a href="#3-4-4-通过-amp-amp-进行条件渲染" class="headerlink" title="3.4.4 通过&amp;&amp;进行条件渲染"></a>3.4.4 通过&amp;&amp;进行条件渲染</h3><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//Mailbox.tsx</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

type Props <span class="token operator">=</span> <span class="token punctuation">{</span>
  unreadMessages<span class="token operator">?</span><span class="token punctuation">:</span> string<span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span> 

<span class="token comment" spellcheck="true">//解构赋值  如果没有给unreadMessages指定值的时候，默认用[]</span>
<span class="token keyword">const</span> Mailbox<span class="token punctuation">:</span> FC<span class="token operator">&lt;</span>Props<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>unreadMessages<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>h1<span class="token operator">></span>Hello<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
      <span class="token punctuation">{</span>unreadMessages<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span>
        <span class="token operator">&lt;</span>h2<span class="token operator">></span>
          You have <span class="token punctuation">{</span>unreadMessages<span class="token punctuation">.</span>length<span class="token punctuation">}</span> unread messages<span class="token punctuation">.</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Mailbox<span class="token punctuation">;</span>


<span class="token comment" spellcheck="true">//index.tsx</span>
<span class="token keyword">const</span> messages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'React'</span><span class="token punctuation">,</span> <span class="token string">'Re: React'</span><span class="token punctuation">,</span> <span class="token string">'Re:Re: React'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>div<span class="token operator">></span>
  <span class="token operator">&lt;</span>Mailbox unreadMessages<span class="token operator">=</span><span class="token punctuation">{</span>messages<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Mailbox<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<h2 id="3-5-列表渲染"><a href="#3-5-列表渲染" class="headerlink" title="3.5 列表渲染"></a>3.5 列表渲染</h2><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//NumberList.tsx</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

type Props <span class="token operator">=</span> <span class="token punctuation">{</span>
  numbers<span class="token operator">?</span><span class="token punctuation">:</span>number<span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//key 帮助 React 识别哪些元素改变了，比如被添加或删除。因此你应当给数组中的每一个元素赋予一个确定的标识。</span>
<span class="token comment" spellcheck="true">//一个元素的 key 最好是这个元素在列表中拥有的一个独一无二的字符串。通常，我们使用来自数据 id 来作为元素的 key。key在兄弟节点之间必须唯一</span>
<span class="token comment" spellcheck="true">//当元素没有确定 id 的时候，万不得已你可以使用元素索引 index 作为 key：</span>
<span class="token keyword">const</span> NumberList<span class="token punctuation">:</span> FC<span class="token operator">&lt;</span>Props<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>numbers<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> listItems <span class="token operator">=</span> numbers<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>number<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token punctuation">{</span>number<span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>ul<span class="token operator">></span><span class="token punctuation">{</span>listItems<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> NumberList<span class="token punctuation">;</span>



<span class="token comment" spellcheck="true">//index.tsx</span>
<span class="token keyword">const</span> numbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>div<span class="token operator">></span>
  <span class="token operator">&lt;</span>NumberList numbers<span class="token operator">=</span><span class="token punctuation">{</span>numbers<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>NumberList<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<h2 id="3-6-Fragment的使用"><a href="#3-6-Fragment的使用" class="headerlink" title="3.6 Fragment的使用"></a>3.6 Fragment的使用</h2><p>有时，语义化的 HTML 会被破坏。比如当在 JSX 中使用 <code>&lt;div&gt;</code> 元素来实现 React 代码功能的时候，又或是在使用列表（<code>&lt;ol&gt;</code>， <code>&lt;ul&gt;</code> 和 <code>&lt;dl&gt;</code>）和 HTML <code>&lt;table&gt;</code> 时。 在这种情况下，我们应该使用 <a target="_blank" rel="noopener" href="https://react.docschina.org/docs/fragments.html">React Fragments</a> 来组合各个组件。</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//ListItem.tsx</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token comment" spellcheck="true">//这边把?去掉，表示父组件在使用当前组件的时候item必传</span>
type Props <span class="token operator">=</span> <span class="token punctuation">{</span>
  item<span class="token punctuation">:</span> <span class="token punctuation">{</span> term<span class="token punctuation">:</span> string<span class="token punctuation">,</span> description<span class="token punctuation">:</span> string <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> ListItem<span class="token punctuation">:</span> FC<span class="token operator">&lt;</span>Props<span class="token operator">></span> <span class="token operator">=</span> props <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> item <span class="token operator">=</span> props<span class="token punctuation">.</span>item<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>React<span class="token punctuation">.</span>Fragment<span class="token operator">></span>
      <span class="token operator">&lt;</span>dt<span class="token operator">></span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>term<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>dt<span class="token operator">></span>
      <span class="token operator">&lt;</span>dd<span class="token operator">></span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>description<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>dd<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>React<span class="token punctuation">.</span>Fragment<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> ListItem<span class="token punctuation">;</span>


<span class="token comment" spellcheck="true">//index.tsx</span>
<span class="token keyword">const</span> items <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    term<span class="token punctuation">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
    description<span class="token punctuation">:</span> <span class="token string">"描述1"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    term<span class="token punctuation">:</span> <span class="token string">"2"</span><span class="token punctuation">,</span>
    description<span class="token punctuation">:</span> <span class="token string">"描述2"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>div<span class="token operator">></span>
  <span class="token operator">&lt;</span>dl<span class="token operator">></span>
    <span class="token punctuation">{</span>
      items<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>ListItem item<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span> key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>term<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>dl<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<h2 id="3-7-React组合"><a href="#3-7-React组合" class="headerlink" title="3.7 React组合"></a>3.7 React组合</h2><p>react组合类似于Vue中的slot(插槽)，子组件的内容由父组件来指定</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//FancyBorder.tsx</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

type Props <span class="token operator">=</span> <span class="token punctuation">{</span>
  color<span class="token operator">?</span><span class="token punctuation">:</span>string
<span class="token punctuation">}</span>

<span class="token keyword">const</span> FancyBorder<span class="token punctuation">:</span> FC<span class="token operator">&lt;</span>Props<span class="token operator">></span> <span class="token operator">=</span> props <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>color<span class="token punctuation">:</span>props<span class="token punctuation">.</span>color<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token punctuation">{</span><span class="token comment" spellcheck="true">/*子组件：占坑*/</span><span class="token punctuation">}</span>
      <span class="token punctuation">{</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> FancyBorder<span class="token punctuation">;</span>


<span class="token comment" spellcheck="true">//index.tsx</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>div<span class="token operator">></span>
  <span class="token operator">&lt;</span>FancyBorder color<span class="token operator">=</span><span class="token string">"blue"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>孩儿们<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>FancyBorder<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<p>少数情况下，你可能需要在一个组件中预留出几个“洞”。这种情况下，我们可以不使用 children，而是自行约定：将所需内容传入 props，并使用相应的 prop。</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//SplitPane.tsx</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> MouseEvent<span class="token punctuation">,</span> FC <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

type Props <span class="token operator">=</span> <span class="token punctuation">{</span>
  left<span class="token operator">?</span><span class="token punctuation">:</span>JSX<span class="token punctuation">.</span>Element<span class="token punctuation">,</span>
  right<span class="token operator">?</span><span class="token punctuation">:</span>JSX<span class="token punctuation">.</span>Element
<span class="token punctuation">}</span>

<span class="token keyword">const</span> SplitPane<span class="token punctuation">:</span> FC<span class="token operator">&lt;</span>Props<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"SplitPane"</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"SplitPane-left"</span><span class="token operator">></span>
        <span class="token punctuation">{</span>props<span class="token punctuation">.</span>left<span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"SplitPane-right"</span><span class="token operator">></span>
        <span class="token punctuation">{</span>props<span class="token punctuation">.</span>right<span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> SplitPane<span class="token punctuation">;</span>


<span class="token comment" spellcheck="true">//index.tsx</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>div<span class="token operator">></span>
  <span class="token operator">&lt;</span>SplitPane
    left<span class="token operator">=</span><span class="token punctuation">{</span>
      <span class="token operator">&lt;</span>div<span class="token operator">></span>左边<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">}</span>
    right<span class="token operator">=</span><span class="token punctuation">{</span>
      <span class="token operator">&lt;</span>div<span class="token operator">></span>右边<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<h1 id="4-评论列表案例"><a href="#4-评论列表案例" class="headerlink" title="4. 评论列表案例"></a>4. 评论列表案例</h1><h2 id="4-1-启用sass"><a href="#4-1-启用sass" class="headerlink" title="4.1 启用sass"></a>4.1 启用sass</h2><p><a href="mailto:react-scripts@2.0.0">react-scripts@2.0.0</a> 以上版本才适用。</p>
<p>react-scripts主要设计原理是将配置好的如 <code>Webpack，Babel，ESLint</code> ，合并到 <code>react-scripts</code> 这npm包中，用户就可以开箱即用。很多开发者都在这基础上进行改造开发。注意 <code>react-scripts</code> 就是create-react-app脚手架的核心配置代码。</p>
<h3 id="4-1-1-安装依赖"><a href="#4-1-1-安装依赖" class="headerlink" title="4.1.1 安装依赖"></a>4.1.1 安装依赖</h3><p>要使用Sass必须首先安装   <code>node-sass</code></p>
<pre class=" language-sc"><code class="language-sc">$ npm install node-sass --save
$ # or
$ yarn add node-sass

//配置node-sass的二进制包
npm config set sass_binary_site https://npm.taobao.org/mirrors/node-sass/</code></pre>
<p>安装完之后，我们就可以直接在组件中引入scss文件了。</p>
<h3 id="4-1-2-在sass文件中引入其他sass文件"><a href="#4-1-2-在sass文件中引入其他sass文件" class="headerlink" title="4.1.2 在sass文件中引入其他sass文件"></a>4.1.2 在sass文件中引入其他sass文件</h3><pre class=" language-js"><code class="language-js">@<span class="token keyword">import</span> <span class="token string">'styles/colors.scss'</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">//这边路径以当前文件路径为参照</span></code></pre>
<h2 id="4-2-案例完成"><a href="#4-2-案例完成" class="headerlink" title="4.2 案例完成"></a>4.2 案例完成</h2><p>思路：父组件中套了若干个评论Item子组件，所以需要创建两个组件，分别是：CmtList和CmtItem</p>
<h3 id="4-2-1-CmtList-tsx"><a href="#4-2-1-CmtList-tsx" class="headerlink" title="4.2.1 CmtList.tsx"></a>4.2.1 CmtList.tsx</h3><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> CmtItem <span class="token keyword">from</span> <span class="token string">"./CmtItem"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">"./CmtList.scss"</span><span class="token punctuation">;</span>

type Props <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> CmtList<span class="token punctuation">:</span> FC<span class="token operator">&lt;</span>Props<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>commentList<span class="token punctuation">,</span> SetCommentList<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> user<span class="token punctuation">:</span> <span class="token string">'张三'</span><span class="token punctuation">,</span> content<span class="token punctuation">:</span> <span class="token string">'哈哈，沙发'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> user<span class="token punctuation">:</span> <span class="token string">'李四'</span><span class="token punctuation">,</span> content<span class="token punctuation">:</span> <span class="token string">'哈哈，板凳'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> user<span class="token punctuation">:</span> <span class="token string">'王五'</span><span class="token punctuation">,</span> content<span class="token punctuation">:</span> <span class="token string">'哈哈，凉席'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> user<span class="token punctuation">:</span> <span class="token string">'赵六'</span><span class="token punctuation">,</span> content<span class="token punctuation">:</span> <span class="token string">'哈哈，砖头'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> user<span class="token punctuation">:</span> <span class="token string">'田七'</span><span class="token punctuation">,</span> content<span class="token punctuation">:</span> <span class="token string">'哈哈，楼下山炮'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>div<span class="token operator">></span>
    <span class="token punctuation">{</span><span class="token comment" spellcheck="true">/* 样式的第一种写法：直接用行内样式 */</span><span class="token punctuation">}</span>
    <span class="token punctuation">{</span><span class="token comment" spellcheck="true">/* &lt;h1 style={{ color: 'red', fontSize: '35px', zIndex: 3, fontWeight: 200, textAlign: 'center' }}>这是评论列表组件&lt;/h1> */</span><span class="token punctuation">}</span>

    <span class="token operator">&lt;</span>h1<span class="token operator">></span>这是评论列表组件<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
    <span class="token punctuation">{</span>commentList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&lt;</span>CmtItem <span class="token punctuation">{</span><span class="token operator">...</span>item<span class="token punctuation">}</span> key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>CmtItem<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">}</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> CmtList<span class="token punctuation">;</span></code></pre>
<h3 id="4-2-2-CmtList-scss"><a href="#4-2-2-CmtList-scss" class="headerlink" title="4.2.2 CmtList.scss"></a>4.2.2 CmtList.scss</h3><pre class=" language-css"><code class="language-css"><span class="token selector">h1</span><span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span>red<span class="token punctuation">;</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span><span class="token number">35</span>px<span class="token punctuation">;</span>
  <span class="token property">z-index</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token property">font-weight</span><span class="token punctuation">:</span><span class="token number">200</span><span class="token punctuation">;</span>
  <span class="token property">text-align</span><span class="token punctuation">:</span>center<span class="token punctuation">;</span>
  <span class="token property">font-style</span><span class="token punctuation">:</span> italic<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="4-2-3-CmtItem-tsx"><a href="#4-2-3-CmtItem-tsx" class="headerlink" title="4.2.3 CmtItem.tsx"></a>4.2.3 CmtItem.tsx</h3><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token string">'./CmtItem.scss'</span>


type Props <span class="token operator">=</span> <span class="token punctuation">{</span>
  user<span class="token operator">?</span><span class="token punctuation">:</span> string<span class="token punctuation">,</span>
  content<span class="token operator">?</span><span class="token punctuation">:</span> string
<span class="token punctuation">}</span>

<span class="token keyword">const</span> CmtItem<span class="token punctuation">:</span> FC<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Props</span><span class="token punctuation">></span></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>user<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>评论人：<span class="token punctuation">{</span>props<span class="token punctuation">.</span>user<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>评论内容：<span class="token punctuation">{</span>props<span class="token punctuation">.</span>content<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> CmtItem<span class="token punctuation">;</span></code></pre>
<h3 id="4-2-4-CmtItem-scss"><a href="#4-2-4-CmtItem-scss" class="headerlink" title="4.2.4 CmtItem.scss"></a>4.2.4 CmtItem.scss</h3><pre class=" language-css"><code class="language-css"><span class="token selector"><span class="token class">.item</span></span><span class="token punctuation">{</span>
  <span class="token selector">border: 1px dashed <span class="token id">#ccc</span>;
  margin: 10px;
  padding: 10px;
  box-shadow: 0 0 10px <span class="token id">#ccc</span>;

  <span class="token class">.user</span></span><span class="token punctuation">{</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">14</span>px<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token selector"><span class="token class">.content</span></span><span class="token punctuation">{</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">12</span>px<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="4-2-5-问题"><a href="#4-2-5-问题" class="headerlink" title="4.2.5 问题"></a>4.2.5 问题</h3><p>当我们在CmtList.css中指定了h1标签的样式的时候，我们发现  <code>import "./CmtList.scss";'</code> 之后，CmtList和CmtItem中的h1标签都变成了倾斜，说明CmtList中的样式全局生效了。原因在于webpack进行打包的时候会将所有内容打包到一个js文件，所以打包后的样式会全局生效。</p>
<h2 id="4-3-使用CSS模块化"><a href="#4-3-使用CSS模块化" class="headerlink" title="4.3 使用CSS模块化"></a>4.3 使用CSS模块化</h2><p>在cra脚手架中，如果某个样式文件要开启模块化，只需要把样式文件命名为xx.module.css/xx.module.scss就可以了</p>
<h3 id="4-3-1-CmtList-module-scss"><a href="#4-3-1-CmtList-module-scss" class="headerlink" title="4.3.1 CmtList.module.scss"></a>4.3.1 CmtList.module.scss</h3><pre class=" language-css"><code class="language-css"><span class="token comment" spellcheck="true">/* css 模块化只针对类选择器 和 Id选择器生效， 不会对标签选择器模块化 */</span>
<span class="token selector">h1</span><span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span>red<span class="token punctuation">;</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span><span class="token number">35</span>px<span class="token punctuation">;</span>
  <span class="token property">z-index</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token property">font-weight</span><span class="token punctuation">:</span><span class="token number">200</span><span class="token punctuation">;</span>
  <span class="token property">text-align</span><span class="token punctuation">:</span>center<span class="token punctuation">;</span>
  <span class="token property">font-style</span><span class="token punctuation">:</span> italic<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">/* 注意： 被 :local() 包裹起来的类名会被模块化； 默认情况下所有的类和id选择器都会被模块化了； */</span>
<span class="token selector"><span class="token class">.title</span></span><span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>
  <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
  <span class="token property">font-weight</span><span class="token punctuation">:</span> <span class="token number">800</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment" spellcheck="true">/* 注意：被 :global() 包裹起来的类名，不会被模块化，而是会全局生效； */</span> 
<span class="token selector"><span class="token pseudo-class">:global(.test)</span></span><span class="token punctuation">{</span>
  <span class="token property">font-style</span><span class="token punctuation">:</span> italic<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="4-3-2-CmtList-tsx"><a href="#4-3-2-CmtList-tsx" class="headerlink" title="4.3.2 CmtList.tsx"></a>4.3.2 CmtList.tsx</h3><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">import</span> cssObj <span class="token keyword">from</span>  <span class="token string">'./CmtList.module.scss'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cssObj<span class="token punctuation">)</span>

 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>cssObj<span class="token punctuation">.</span>title<span class="token punctuation">}</span></span><span class="token punctuation">></span></span>这是评论列表组件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></code></pre>
<h3 id="4-3-3-总结"><a href="#4-3-3-总结" class="headerlink" title="4.3.3 总结"></a>4.3.3 总结</h3><ol>
<li>使用 <code>:local()</code> 和 <code>:global()</code><ul>
<li><code>:local()</code>包裹的类名，是被模块化的类名，只能通过<code>className={cssObj.类名}</code>来使用。<code>:local</code>可以省略</li>
<li><code>:global()</code>包裹的类名，是全局生效的，不会被 <code>css-modules</code> 控制，定义的类名是什么，就是使用定义的类名<code>className="类名"</code></li>
</ul>
</li>
<li>注意：只有<code>.title</code>这样的类样式或者id选择器，才会被模块化控制，类似于<code>body</code>这样的标签选择器，不会被模块化控制；</li>
</ol>
<h1 id="5-React-事件处理"><a href="#5-React-事件处理" class="headerlink" title="5. React 事件处理"></a>5. React 事件处理</h1><p><a target="_blank" rel="noopener" href="https://reactjs.org/docs/events.html">https://reactjs.org/docs/events.html</a></p>
<h2 id="5-1-函数组件的事件绑定"><a href="#5-1-函数组件的事件绑定" class="headerlink" title="5.1 函数组件的事件绑定"></a>5.1 函数组件的事件绑定</h2><ol>
<li><p>事件的名称都是React的提供的，因此名称的首字母必须大写<code>onClick</code>、<code>onMouseOver</code></p>
</li>
<li><p>为事件提供的处理函数，必须是如下格式 </p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span> <span class="token keyword">function</span> <span class="token punctuation">}</span><span class="token operator">></span>按钮<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span></code></pre>
</li>
<li><p>事件绑定方式：</p>
<pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

type Props <span class="token operator">=</span> <span class="token punctuation">{</span> 
<span class="token punctuation">}</span>

<span class="token keyword">const</span> App<span class="token punctuation">:</span> FC<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Props</span><span class="token punctuation">></span></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> show <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"show方法"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> show2 <span class="token operator">=</span> <span class="token punctuation">(</span>msg<span class="token punctuation">:</span>string<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"show2方法"</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>show<span class="token punctuation">}</span></span><span class="token punctuation">></span></span>按钮<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span> <span class="token function">show2</span><span class="token punctuation">(</span><span class="token string">"参数"</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span>按钮<span class="token number">2</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>
</code></pre>
</li>
</ol>
<h2 id="5-2-绑定文本框与state中的值"><a href="#5-2-绑定文本框与state中的值" class="headerlink" title="5.2 绑定文本框与state中的值"></a>5.2 绑定文本框与state中的值</h2><ol>
<li><p>在Vue中提供了<code>v-model</code>指令，可以很方便的实现 <code>数据的双向绑定</code>；</p>
</li>
<li><p>但是在React中只是<code>单向数据流</code>，也就是只能把state上的数据绑定到页面，无法把页面中数据的变化自动同步回 state ； 如果需要把页面上数据的变化保存到 state，则需要程序员手动监听<code>onChange</code>事件，拿到最新的数据，手动调用<code>this.setState({  })</code> 更改回去。 这种方式叫受控组件</p>
</li>
</ol>
<h3 id="5-2-1-表单受控组件"><a href="#5-2-1-表单受控组件" class="headerlink" title="5.2.1 表单受控组件"></a>5.2.1 表单受控组件</h3><p>在 HTML 中，表单元素（如<code>&lt;input&gt;</code>、 <code>&lt;textarea&gt;</code> 和 <code>&lt;select&gt;</code>）之类的表单元素通常自己维护 state，并根据用户输入进行更新。而在 React 中，可变状态（mutable state）通常保存在组件的 state 属性中，并且只能通过使用 <a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/docs/react-component.html#setstate"><code>setState()</code></a>来更新。</p>
<p>我们可以把两者结合起来，使 React 的 state 成为“唯一数据源”。渲染表单的 React 组件还控制着用户输入过程中表单发生的操作。被 React 以这种方式控制取值的表单输入元素就叫做“受控组件”。</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

type Props <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> App<span class="token punctuation">:</span> FC<span class="token operator">&lt;</span>Props<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>value<span class="token punctuation">,</span> setValue<span class="token punctuation">]</span> <span class="token operator">=</span> useState<span class="token operator">&lt;</span>string<span class="token operator">></span><span class="token punctuation">(</span><span class="token string">"默认数据"</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> inputChange <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">:</span> React<span class="token punctuation">.</span>ChangeEvent<span class="token operator">&lt;</span>HTMLInputElement<span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token function">setValue</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span>inputChange<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></code></pre>
<h3 id="5-2-2-表单非受控组件"><a href="#5-2-2-表单非受控组件" class="headerlink" title="5.2.2 表单非受控组件"></a>5.2.2 表单非受控组件</h3><p>在大多数情况下，我们推荐使用 <a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/docs/forms.html#controlled-components">受控组件</a> 来处理表单数据。在一个受控组件中，表单数据是由 React 组件来管理的。另一种替代方案是使用非受控组件，这时表单数据将交由 DOM 节点来处理。</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span> useState<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

type Props <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> App<span class="token punctuation">:</span> FC<span class="token operator">&lt;</span>Props<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">//引用页面元素</span>
  <span class="token keyword">const</span> inputRef <span class="token operator">=</span> useRef<span class="token operator">&lt;</span>HTMLInputElement<span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> handleSubmit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>inputRef<span class="token punctuation">.</span>current <span class="token operator">&amp;&amp;</span> inputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> ref<span class="token operator">=</span><span class="token punctuation">{</span>inputRef<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"button"</span> value<span class="token operator">=</span><span class="token string">"点我"</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleSubmit<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>input<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>
</code></pre>
<p>因为非受控组件将真实数据储存在 DOM 节点中，所以在使用非受控组件时，有时候反而更容易同时集成 React 和非 React 代码。如果你不介意代码美观性，并且希望快速编写代码，使用非受控组件往往可以减少你的代码量。否则，你应该使用受控组件。</p>
<h3 id="5-2-3-受控组件和非受控组件"><a href="#5-2-3-受控组件和非受控组件" class="headerlink" title="5.2.3 受控组件和非受控组件"></a>5.2.3 受控组件和非受控组件</h3><p>“受控”和“不受控制”的术语通常指的是表单输入，但他们还可以描述任何组件数据的位置。作为props传递进组件的数据可以被认为是<strong>受控的</strong>（因为父组件控制数据）。只存在于内部状态的数据可以被认为是<strong>不受控制的</strong>（因为父类不能直接更改它）。</p>
<h2 id="5-3-React父子组件的通信"><a href="#5-3-React父子组件的通信" class="headerlink" title="5.3 React父子组件的通信"></a>5.3 React父子组件的通信</h2><h3 id="5-3-1-父组件传递给子组件"><a href="#5-3-1-父组件传递给子组件" class="headerlink" title="5.3.1 父组件传递给子组件"></a>5.3.1 父组件传递给子组件</h3><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//父组件</span>
<span class="token operator">&lt;</span>CMTItem key<span class="token operator">=</span><span class="token punctuation">{</span>i<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token operator">...</span>item<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>CMTItem<span class="token operator">></span>

<span class="token comment" spellcheck="true">//子组件通过props可以获取到父组件传递过来的数据</span></code></pre>
<h3 id="5-3-2-子组件传递给父组件"><a href="#5-3-2-子组件传递给父组件" class="headerlink" title="5.3.2 子组件传递给父组件"></a>5.3.2 子组件传递给父组件</h3><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//父组件</span>
 <span class="token operator">&lt;</span>CMTBox reload<span class="token operator">=</span><span class="token punctuation">{</span>loadCmts<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>CMTBox<span class="token operator">></span>

<span class="token comment" spellcheck="true">//子组件通过props.reload() 来调用父组件的方法，调用的时候可以传递参数</span></code></pre>
<h3 id="5-3-3-评论列表发表评论"><a href="#5-3-3-评论列表发表评论" class="headerlink" title="5.3.3 评论列表发表评论"></a>5.3.3 评论列表发表评论</h3><pre class=" language-javascript"><code class="language-javascript">#<span class="token number">1</span><span class="token punctuation">.</span>CmtList<span class="token punctuation">.</span>jsx
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> CmtItem <span class="token keyword">from</span> <span class="token string">"./CmtItem"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> CmtBox <span class="token keyword">from</span> <span class="token string">"./CmtBox"</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// import "./CmtList.scss";</span>
<span class="token keyword">import</span> cssObj <span class="token keyword">from</span> <span class="token string">'./CmtList.module.scss'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cssObj<span class="token punctuation">)</span>

type Props <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> CmtList<span class="token punctuation">:</span> FC<span class="token operator">&lt;</span>Props<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>commentList<span class="token punctuation">,</span> SetCommentList<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> user<span class="token punctuation">:</span> <span class="token string">'张三'</span><span class="token punctuation">,</span> content<span class="token punctuation">:</span> <span class="token string">'哈哈，沙发'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> user<span class="token punctuation">:</span> <span class="token string">'李四'</span><span class="token punctuation">,</span> content<span class="token punctuation">:</span> <span class="token string">'哈哈，板凳'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> user<span class="token punctuation">:</span> <span class="token string">'王五'</span><span class="token punctuation">,</span> content<span class="token punctuation">:</span> <span class="token string">'哈哈，凉席'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> user<span class="token punctuation">:</span> <span class="token string">'赵六'</span><span class="token punctuation">,</span> content<span class="token punctuation">:</span> <span class="token string">'哈哈，砖头'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> user<span class="token punctuation">:</span> <span class="token string">'田七'</span><span class="token punctuation">,</span> content<span class="token punctuation">:</span> <span class="token string">'哈哈，楼下山炮'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> reload <span class="token operator">=</span> <span class="token punctuation">(</span>obj<span class="token punctuation">:</span><span class="token punctuation">{</span>id<span class="token punctuation">:</span>number<span class="token punctuation">,</span>user<span class="token punctuation">:</span>string<span class="token punctuation">,</span>content<span class="token punctuation">:</span>string<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token function">SetCommentList</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>commentList<span class="token punctuation">,</span> obj<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>div<span class="token operator">></span>
    <span class="token punctuation">{</span><span class="token comment" spellcheck="true">/* 样式的第一种写法：直接用行内样式 */</span><span class="token punctuation">}</span>
    <span class="token punctuation">{</span><span class="token comment" spellcheck="true">/* &lt;h1 style={{ color: 'red', fontSize: '35px', zIndex: 3, fontWeight: 200, textAlign: 'center' }}>这是评论列表组件&lt;/h1> */</span><span class="token punctuation">}</span>

    <span class="token operator">&lt;</span>h1<span class="token operator">></span>这是评论列表组件<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
    <span class="token punctuation">{</span>commentList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&lt;</span>CmtItem <span class="token punctuation">{</span><span class="token operator">...</span>item<span class="token punctuation">}</span> key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>CmtItem<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span>CmtBox reload<span class="token operator">=</span><span class="token punctuation">{</span>reload<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>CmtBox<span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> CmtList<span class="token punctuation">;</span>



#<span class="token number">2</span><span class="token punctuation">.</span>CmtItem<span class="token punctuation">.</span>jsx
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token string">'./CmtItem.scss'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">CmtItem</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"item"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>h1 className<span class="token operator">=</span><span class="token string">"user"</span><span class="token operator">></span>评论人：<span class="token punctuation">{</span>props<span class="token punctuation">.</span>user<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
    <span class="token operator">&lt;</span>p className<span class="token operator">=</span><span class="token string">"content"</span><span class="token operator">></span>评论内容：<span class="token punctuation">{</span>props<span class="token punctuation">.</span>content<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

#<span class="token number">3</span><span class="token punctuation">.</span>CmtBox<span class="token punctuation">.</span>jsx
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token string">'./CmtItem.scss'</span>


type Props <span class="token operator">=</span> <span class="token punctuation">{</span>
  reload<span class="token operator">?</span><span class="token punctuation">(</span>obj<span class="token punctuation">:</span> Object<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> CmtBox<span class="token punctuation">:</span> FC<span class="token operator">&lt;</span>Props<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>user<span class="token punctuation">,</span> setUser<span class="token punctuation">]</span> <span class="token operator">=</span> useState<span class="token operator">&lt;</span>string<span class="token operator">></span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>content<span class="token punctuation">,</span> setContent<span class="token punctuation">]</span> <span class="token operator">=</span> useState<span class="token operator">&lt;</span>string<span class="token operator">></span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">//操作的是哪个文本框就去修改哪个文本框的数据</span>
  <span class="token keyword">const</span> changeHandler <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">:</span> React<span class="token punctuation">.</span>ChangeEvent<span class="token operator">&lt;</span>HTMLInputElement<span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> tag <span class="token operator">=</span> e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>tag <span class="token operator">==</span> <span class="token string">"user"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setUser</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">setContent</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> postComment <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">&amp;&amp;</span> content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      props<span class="token punctuation">.</span>reload <span class="token operator">&amp;&amp;</span> props<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        user<span class="token punctuation">,</span>
        content<span class="token punctuation">,</span>
        id<span class="token punctuation">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token operator">+</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">100</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token function">setUser</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">setContent</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>div<span class="token operator">></span>
    <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">"user"</span><span class="token operator">></span>用户名<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
    <span class="token operator">&lt;</span>input id<span class="token operator">=</span><span class="token string">"user"</span> type<span class="token operator">=</span><span class="token string">"text"</span> value<span class="token operator">=</span><span class="token punctuation">{</span>user<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span>changeHandler<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>input<span class="token operator">></span>

    <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">"content"</span><span class="token operator">></span>内容<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
    <span class="token operator">&lt;</span>input id<span class="token operator">=</span><span class="token string">"content"</span> type<span class="token operator">=</span><span class="token string">"text"</span> value<span class="token operator">=</span><span class="token punctuation">{</span>content<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span>changeHandler<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>input<span class="token operator">></span>

    <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"button"</span> value<span class="token operator">=</span><span class="token string">"发表评论"</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">postComment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> CmtBox<span class="token punctuation">;</span></code></pre>
<h2 id="5-4-Ref-Hook"><a href="#5-4-Ref-Hook" class="headerlink" title="5.4 Ref Hook"></a>5.4 Ref Hook</h2><blockquote>
<p>“ref”对象是一个通用容器，其current属性是可变的。返回的 ref 对象在组件的整个生命周期内保持不变。</p>
</blockquote>
<h3 id="5-4-1-保存dom"><a href="#5-4-1-保存dom" class="headerlink" title="5.4.1 保存dom"></a>5.4.1 保存dom</h3><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span> useRef<span class="token punctuation">,</span> useEffect <span class="token punctuation">,</span> RefObject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

type Props <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> Test<span class="token punctuation">:</span> FC<span class="token operator">&lt;</span>Props<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> t<span class="token punctuation">:</span>RefObject<span class="token operator">&lt;</span>HTMLDivElement<span class="token operator">></span> <span class="token operator">=</span> useRef<span class="token operator">&lt;</span>HTMLDivElement<span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">//相当于componentDidMount 、componentDidUpdate</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// div</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div ref<span class="token operator">=</span><span class="token punctuation">{</span>t<span class="token punctuation">}</span><span class="token operator">></span> <span class="token operator">...</span> <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Test<span class="token punctuation">;</span></code></pre>
<h3 id="5-4-2-forwardRef"><a href="#5-4-2-forwardRef" class="headerlink" title="5.4.2 forwardRef"></a>5.4.2 forwardRef</h3><pre class=" language-jsx"><code class="language-jsx"><span class="token comment" spellcheck="true">// father</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span> useRef<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Son <span class="token keyword">from</span> <span class="token string">'./Son'</span><span class="token punctuation">;</span>

type Props <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> Father<span class="token punctuation">:</span> FC<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Props</span><span class="token punctuation">></span></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> refContainer <span class="token operator">=</span> useRef<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>HTMLInputElement</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> changeInput <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
      refContainer<span class="token punctuation">.</span>current<span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>refContainer<span class="token punctuation">.</span>current<span class="token punctuation">.</span>value<span class="token operator">=</span><span class="token string">'啊，我被改了!'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>changeInput<span class="token punctuation">}</span></span><span class="token punctuation">></span></span>changeInput<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Son</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>refContainer<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Son</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Father<span class="token punctuation">;</span></code></pre>
<pre class=" language-jsx"><code class="language-jsx"><span class="token comment" spellcheck="true">// Son</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> forwardRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">const</span> Son <span class="token operator">=</span> React<span class="token punctuation">.</span>forwardRef<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>HTMLInputElement</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> ref<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>input</span><span class="token punctuation">></span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Son<span class="token punctuation">;</span></code></pre>
<h3 id="5-4-3-useImperativeHandle"><a href="#5-4-3-useImperativeHandle" class="headerlink" title="5.4.3 useImperativeHandle"></a>5.4.3 useImperativeHandle</h3><blockquote>
<p><code>useImperativeHandle</code> 可以让你在使用 <code>ref</code> 时给父组件暴露的指定的值。在大多数情况下，应当避免使用 ref 这样的命令式代码。<code>useImperativeHandle</code> 应当与 <code>forwardRef</code> 一起使用</p>
</blockquote>
<pre class=" language-jsx"><code class="language-jsx"><span class="token comment" spellcheck="true">//father</span>

<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span> useRef<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> RefObject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Son <span class="token keyword">from</span> <span class="token string">'./Son'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> InputRefProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./type"</span><span class="token punctuation">;</span>

type Props <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> Father<span class="token punctuation">:</span> FC<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Props</span><span class="token punctuation">></span></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> refContainer <span class="token operator">=</span> useRef<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>InputRefProps</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> changeInput <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    refContainer<span class="token punctuation">.</span>current <span class="token operator">&amp;&amp;</span> refContainer<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> talk <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    refContainer<span class="token punctuation">.</span>current <span class="token operator">&amp;&amp;</span> refContainer<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">talk</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>changeInput<span class="token punctuation">}</span></span><span class="token punctuation">></span></span>changeInput<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>talk<span class="token punctuation">}</span></span><span class="token punctuation">></span></span>talk<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Son</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>refContainer<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Son</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Father<span class="token punctuation">;</span></code></pre>
<pre class=" language-jsx"><code class="language-jsx"><span class="token comment" spellcheck="true">// Son</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> forwardRef<span class="token punctuation">,</span>useRef<span class="token punctuation">,</span>useImperativeHandle <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> InputRefProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./type"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Son <span class="token operator">=</span> React<span class="token punctuation">.</span>forwardRef<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>InputRefProps</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> ref<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">//新建一个ref  将此ref绑定在本组建内的input上</span>
  <span class="token keyword">const</span> inputRef <span class="token operator">=</span> useRef<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>HTMLInputElement</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">//将 使得本组件input获取焦点的方法赋给父组件传递来的ref上 </span>
  <span class="token function">useImperativeHandle</span><span class="token punctuation">(</span>ref<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
      focus<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        inputRef<span class="token punctuation">.</span>current <span class="token operator">&amp;&amp;</span> inputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      talk<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello, world!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>inputRef<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>input</span><span class="token punctuation">></span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Son<span class="token punctuation">;</span></code></pre>
<pre class=" language-typescript"><code class="language-typescript"><span class="token comment" spellcheck="true">//type.d.ts</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">InputRefProps</span> <span class="token punctuation">{</span>
  <span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token function">talk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="5-4-4-保存事件-变量"><a href="#5-4-4-保存事件-变量" class="headerlink" title="5.4.4 保存事件/变量"></a>5.4.4 保存事件/变量</h3><p>在函数组件中，因为每次re-render就意味着函数重新执行一次，因此在函数内部保持变量引用是一件我们需要思考的事情(如果普通变量，每次re-render都会被重新初始化)。</p>
<p>在前面学习useState时我们知道，使用useState定义变量，可以做到这样的事情。同样的，利用ref的.current也可以。</p>
<p>一个很常见的应用场景就是对于定时器的清除。我们需要确保setInterval的执行结果timer的引用，才能准确的清除对应的定时器。</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span> useRef<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">const</span> Timer<span class="token punctuation">:</span>FC<span class="token operator">&lt;</span>Object<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> timerRef <span class="token operator">=</span> useRef<span class="token operator">&lt;</span>NodeJS<span class="token punctuation">.</span>Timeout<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
      timerRef<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'do something'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment" spellcheck="true">// 组件卸载时，清除定时器</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
          timerRef<span class="token punctuation">.</span>current <span class="token operator">&amp;&amp;</span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>timerRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="5-4-5-useState和useRef的区别"><a href="#5-4-5-useState和useRef的区别" class="headerlink" title="5.4.5 useState和useRef的区别"></a>5.4.5 useState和useRef的区别</h3><ul>
<li>每次 Render 的内容都会形成一个快照并保留下来，因此当状态变更而 re-render 时，就形成了 N 个 Render 状态，而每个 Render 状态都拥有自己固定不变的 Props 与 State。(每次Render都有自己的Props、State、事件处理、effect，这就是<strong>Capture Value</strong> 特性)</li>
<li>利用 <code>useRef</code> 就可以绕过 Capture Value 的特性。<strong>可以认为 ref 在所有 Render 过程中保持着唯一引用，因此所有对 ref 的赋值或取值，拿到的都只有一个最终状态</strong></li>
<li>也可以简洁的认为，<code>ref</code> 是 Mutable 的，而 <code>state</code> 是 Immutable 的。</li>
</ul>
<h1 id="6-类组件的生命周期"><a href="#6-类组件的生命周期" class="headerlink" title="6. 类组件的生命周期"></a>6. 类组件的生命周期</h1><h2 id="6-1-生命周期钩子函数介绍"><a href="#6-1-生命周期钩子函数介绍" class="headerlink" title="6.1 生命周期钩子函数介绍"></a>6.1 生命周期钩子函数介绍</h2><ul>
<li><p>生命周期的概念：每个组件的实例，从创建、运行、到销毁，在这个过程中会出发一些列事件，这些事件就叫做组件的生命周期函数；</p>
</li>
<li><p>React组件生命周期(React 16.4+)分为三部分：</p>
<ul>
<li><strong>组件创建阶段</strong>：</li>
</ul>
<blockquote>
<p>static 开头的     只会执行一次</p>
<p>constructor    构造器     只会执行一次</p>
<p>getDerivedStateFromProps: 每次re-rendering之前被调用，作用：将传递的props映射到state里面       会执行多次</p>
<p>render           构建虚拟dom，但是此时虚拟dom还没有渲染到页面        会执行多次</p>
<p>componentDidMount:组建的虚拟dom已经挂载到页面                      只会执行一次</p>
</blockquote>
<ul>
<li><strong>组件运行阶段</strong>：根据 props 属性 或 state 状态的改变，有选择性的执行0到多次</li>
</ul>
<blockquote>
<p>getDerivedStateFromProps:每次re-rendering之前被调用</p>
<p>shouldComponentUpdate:组件是否需要被更新，返回值是true或者false。此时可以获取最新的props和state数据</p>
<p>render: 重新更新渲染组件的虚拟dom</p>
<p>getSnapshotBeforeUpdate：在最近一次渲染提交到 DOM 节点之前调用。它的含义是在React更新Dom元素之前，获取一个快照，它返回的结果将作为componentDidUpdate的第三个参数。一般的用法就是获取更新前的DOM。</p>
<p>componentDidUpdate: 组件完成了更新，此时页面已经是最新的了</p>
</blockquote>
<ul>
<li><strong>组件卸载阶段</strong>：只执行一次</li>
</ul>
<blockquote>
<p>componentWillUnmount: 当组件从 DOM 中移除时会调用如下方法，此时组件还可以被使用</p>
<p><img src="https://i.loli.net/2020/11/09/3fkUDhZFjJo9isp.png" alt="1574654437154.png"></p>
</blockquote>
</li>
</ul>
<p>React生命周期的回调函数总结成表格如下：<br><img src="https://i.loli.net/2020/11/09/Ikbxi25TNhDMEYf.png" alt="1574666830021.png"></p>
<h2 id="6-2-生命周期函数详解"><a href="#6-2-生命周期函数详解" class="headerlink" title="6.2 生命周期函数详解"></a>6.2 生命周期函数详解</h2><blockquote>
<p>在组件创建之前，会先初始化默认的props属性，这是全局调用一次，严格地来说，这不是组件的生命周期的一部分。</p>
</blockquote>
<pre class=" language-javascript"><code class="language-javascript">#<span class="token number">1</span><span class="token punctuation">.</span>Counter<span class="token punctuation">.</span>jsx
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

type IProps <span class="token operator">=</span> Readonly<span class="token operator">&lt;</span><span class="token punctuation">{</span>
  initCount<span class="token punctuation">:</span> number<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">;</span>

<span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span> msg<span class="token punctuation">:</span> <span class="token string">'张三'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
type IState <span class="token operator">=</span> Readonly<span class="token operator">&lt;</span><span class="token keyword">typeof</span> initialState<span class="token operator">></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token operator">&lt;</span>IProps<span class="token punctuation">,</span> IState<span class="token operator">></span> <span class="token punctuation">{</span>
  readonly state<span class="token punctuation">:</span> IState <span class="token operator">=</span> initialState<span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">//-------------------------------组件创建阶段----------------------------------------</span>
  <span class="token comment" spellcheck="true">//1.在组件的创建阶段：第一个执行的是static开头的属性</span>
  <span class="token comment" spellcheck="true">//设定props的默认值：当父组件没有给子组件传递props的时候就会使用这个默认值</span>
  <span class="token keyword">static</span> defaultProps <span class="token operator">=</span> <span class="token punctuation">{</span>
    initCount<span class="token punctuation">:</span> <span class="token number">100</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">//2.在组件创建阶段，第二个执行的是构造函数 (创建一个组件对象执行一次)</span>
  <span class="token comment" spellcheck="true">//构造函数的作用：主要就是用来创建组件对象</span>
  <span class="token comment" spellcheck="true">//我们可以在构造函数中声明当前组件的state</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">:</span> IProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true">//构造函数中只可以给state赋予初始值</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      msg<span class="token punctuation">:</span> <span class="token string">"李四"</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">//构造函数中能够通过setState()来修改state的值</span>
    <span class="token comment" spellcheck="true">// this.setState({</span>
    <span class="token comment" spellcheck="true">//     msg:"李四"</span>
    <span class="token comment" spellcheck="true">// })</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">//3.在组件的创建阶段，第三个执行的是getDerivedStateFromProps</span>
  <span class="token comment" spellcheck="true">//这个方法的作用：就是将props映射到state中</span>
  <span class="token comment" spellcheck="true">//在每一次re-render的时候执行</span>
  <span class="token keyword">static</span> <span class="token function">getDerivedStateFromProps</span><span class="token punctuation">(</span>nextProps<span class="token punctuation">:</span> IProps<span class="token punctuation">,</span> prevState<span class="token punctuation">:</span> IState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"getDerivedStateFromProps"</span><span class="token punctuation">,</span> nextProps<span class="token punctuation">,</span> prevState<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">//4.在组件的创建阶段，第四个执行的是render()方法。(在一个组件的各种生命周期阶段中，至少执行一次)</span>
  <span class="token comment" spellcheck="true">//render()方法的主要作用：在内存中构建虚拟dom(此时虚拟dom还没有被挂载到页面)</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 在render()函数中不能通过setState()来修改state状态，因为这样会陷入死循环</span>
        <span class="token comment" spellcheck="true">// 其实render()函数应该是一个纯函数，这个函数的作用本身就是给他什么数据，他就显示什么数据</span>

        <span class="token comment" spellcheck="true">// this.setState({</span>
        <span class="token comment" spellcheck="true">//     msg:"王五"</span>
        <span class="token comment" spellcheck="true">// })</span>
      <span class="token punctuation">}</span>
      <span class="token operator">&lt;</span>h3<span class="token operator">></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>initCount<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span>
      <span class="token operator">&lt;</span>h3<span class="token operator">></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>msg<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">//5.在组件的创建阶段，第五个执行的是componentDidMount。(创建一个组件对象执行一次)</span>
  <span class="token comment" spellcheck="true">//componentDidMount执行的时候就表示内存中的虚拟dom已经挂载到页面了，此时页面是最新的</span>
  <span class="token comment" spellcheck="true">//只有componentDidMount()钩子函数才可以通过setState()来修改state</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//componentDidMount()方法允许我们通过setState()来修改状态</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      msg<span class="token punctuation">:</span> <span class="token string">"赵六"</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"componentDidMount方法执行了"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>


  <span class="token comment" spellcheck="true">//-------------------------------组价的运行阶段-------------------------------</span>
  <span class="token comment" spellcheck="true">//当前组件的状态发生改变之后，会进入组件的运行阶段</span>
  <span class="token comment" spellcheck="true">//1.在组件运行阶段，第一个执行的函数是getDerivedStateFromProps</span>
  <span class="token comment" spellcheck="true">// static getDerivedStateFromProps(nextProps: IProps, prevState: IState) {</span>
  <span class="token comment" spellcheck="true">//   console.log("getDerivedStateFromProps", nextProps, prevState)</span>
  <span class="token comment" spellcheck="true">//   return null;</span>
  <span class="token comment" spellcheck="true">// }</span>

  <span class="token comment" spellcheck="true">//2.在组件的运行阶段，第二个执行的函数是shouldComponentUpdate。(在组件的各种生命周期阶段中，执行>=0次)</span>
  <span class="token comment" spellcheck="true">//作用：让程序员手动控制是否要更新组件</span>
  <span class="token comment" spellcheck="true">//如果这个方法返回false，就不会更新组件(后续的生命周期函数就不会执行了)；如果这个方法返回true，就会更新组件(后续的生命周期会执行)</span>
  <span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span>nextProps<span class="token punctuation">:</span> IProps<span class="token punctuation">,</span> nextState<span class="token punctuation">:</span> IState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// shouldComponentUpdate() 方法中也不能通过setState()来更改state，此时仍然会进入死循环</span>
    <span class="token comment" spellcheck="true">// this.setState({</span>
    <span class="token comment" spellcheck="true">//     msg:"王五"</span>
    <span class="token comment" spellcheck="true">// })</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"shouldComponentUpdate"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">//3.在组件的运行阶段，第三个执行的函数是render()函数</span>
  <span class="token comment" spellcheck="true">//render()函数的作用：在内存中构建虚拟dom(此时虚拟dom还没有被挂载到页面)</span>

  <span class="token comment" spellcheck="true">//4.在组件的运行阶段，第四个执行的函数是getSnapshotBeforeUpdate。(在组件的各种生命周期阶段中，执行>=0次)</span>
  <span class="token comment" spellcheck="true">//主要作用：获取更新页面之前的dom信息</span>
  <span class="token comment" spellcheck="true">//这个方法的返回值会作为componentDidUpdate()方法第三个参数入参  https://react.docschina.org/docs/react-component.html</span>
  <span class="token function">getSnapshotBeforeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// getSnapshotBeforeUpdate() 方法中也不能通过setState()来更改state，此时仍然会进入死循环</span>
    <span class="token comment" spellcheck="true">// this.setState({</span>
    <span class="token comment" spellcheck="true">//     msg:"王五"</span>
    <span class="token comment" spellcheck="true">// })</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"getSnapshotBeforeUpdate"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> aa<span class="token punctuation">:</span> <span class="token number">123</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">//5.在组件的运行阶段，第五个执行的函数是componentDidUpdate。(在组件的各种生命周期阶段中，执行>=0次)</span>
  <span class="token comment" spellcheck="true">//主要作用：虚拟dom已经挂载到页面，此时页面是最新的</span>
  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span>prevProps<span class="token punctuation">:</span> IProps<span class="token punctuation">,</span> prevState<span class="token punctuation">:</span> IState<span class="token punctuation">,</span> snapshot<span class="token punctuation">:</span> any<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// componentDidUpdate() 方法中也不能通过setState()来更改state，此时仍然会进入死循环</span>
    <span class="token comment" spellcheck="true">// this.setState({</span>
    <span class="token comment" spellcheck="true">//     msg: "王五"</span>
    <span class="token comment" spellcheck="true">// })</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"componentDidUpdate"</span><span class="token punctuation">,</span> snapshot<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">//----------------------------组件的卸载阶段-----------------------------</span>
  <span class="token comment" spellcheck="true">//可以在componentWillUnmount()方法中进行一些资源的释放工作。比如关闭定时器、移除事件监听。(卸载一个组件执行一次)</span>
  <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"componentWillUnmount"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Counter<span class="token punctuation">;</span>


#App<span class="token punctuation">.</span>jsx
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span> useState<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> Counter <span class="token keyword">from</span> <span class="token string">'./components4/Counter'</span>

<span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span> count<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>
type IState <span class="token operator">=</span> Readonly<span class="token operator">&lt;</span><span class="token keyword">typeof</span> initialState<span class="token operator">></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  readonly state<span class="token punctuation">:</span> IState <span class="token operator">=</span> initialState<span class="token punctuation">;</span>

  handleClick <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span>prev<span class="token punctuation">:</span> IState<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        count<span class="token punctuation">:</span> prev<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>div<span class="token operator">></span>
      这是App组件
      <span class="token punctuation">{</span><span class="token comment" spellcheck="true">/* &lt;Counter initCount={this.state.count}>&lt;/Counter> */</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span>Counter<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Counter<span class="token operator">></span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">}</span><span class="token operator">></span>改变count<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></code></pre>
<h2 id="6-3-组件的重新渲染和优化"><a href="#6-3-组件的重新渲染和优化" class="headerlink" title="6.3 组件的重新渲染和优化"></a>6.3 组件的重新渲染和优化</h2><h3 id="6-3-1-类组件的re-render的时机"><a href="#6-3-1-类组件的re-render的时机" class="headerlink" title="6.3.1 类组件的re-render的时机"></a>6.3.1 类组件的re-render的时机</h3><pre><code>什么时候触发类组件的re-render
一：当类组件继承React.Component的时候
1.当前组件中调用了setState会触发组件的re-render，不管当前组件的state有没有发生过变化(原理是setState内部会触发batchingUpdate)
2.当父组件re-render的时候，父组件中的子组件也会re-render，不管父组件有没有给子组件传递过任何数据
3.只要组件re-render的时候，有关于组件运行阶段的生命周期的钩子都会被触发(getDerivedStateFromProps\shouldComponentUpdate\render\getSnapshotBeforeUpdate\componentDidMount\componentDidUpdate)。

二：当类组件继承React.PureComponent的时候
1.当前组件调用了setState之后，只要state数据的内存地址发生变化，就会触发组件的re-render(不管state数据在页面有没有使用)
2.当父组件re-render的时候，子组件不一定再re-render，而是要看父组件给子组件传递了props内存地址有没有发生变化(不管在子组件中有没有使用过父组件传递的props)
3.只要组件re-render的时候，有关于组件运行阶段的生命周期的钩子都会被触发</code></pre>
<p>当组件继承React.Component的时候，我们在父组件修改了与子组件无关的state，而子组件没有用到这个状态，发现子组件也会re-render，这个时候就需要借助shouldComponentUpdate钩子函数来做优化。</p>
<p>我们通常的解决方案是：</p>
<blockquote>
<ol>
<li>使用immutable进行比较，在不相等的时候调用setState；</li>
<li>在shouldComponentUpdate中判断前后的props和state，如果没有变化，则返回false来阻止更新。</li>
<li>创建一个类继承PureComponent，判断页面是否要更新的时候进行浅比较</li>
</ol>
</blockquote>
<h3 id="6-3-2-shouldComponentUpdate优化"><a href="#6-3-2-shouldComponentUpdate优化" class="headerlink" title="6.3.2 shouldComponentUpdate优化"></a>6.3.2 shouldComponentUpdate优化</h3><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//作用：让程序员手动控制是否要更新组件</span>
<span class="token comment" spellcheck="true">//如果这个方法返回false，就不会更新组件(后续的生命周期函数就不会执行了)；如果这个方法返回true，就会更新组件(后续的生命周期会执行)</span>
<span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span>nextProps<span class="token punctuation">:</span> IProps<span class="token punctuation">,</span> nextState<span class="token punctuation">:</span> IState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//当下次传递过来的initCount为偶数的时候，不更新页面。为奇数的时候更新页面</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>nextProps<span class="token punctuation">.</span>initCount<span class="token operator">%</span><span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="6-3-3-PureComponent优化"><a href="#6-3-3-PureComponent优化" class="headerlink" title="6.3.3 PureComponent优化"></a>6.3.3 PureComponent优化</h3><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//ListOfWords.tsx</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

type IProps <span class="token operator">=</span> Readonly<span class="token operator">&lt;</span><span class="token punctuation">{</span>
  words<span class="token punctuation">:</span> string<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 继承React.Component的时候，视图更新通过shouldComponentUpdate完成</span>
<span class="token comment" spellcheck="true">// class ListOfWords extends React.Component&lt;IProps> {</span>

<span class="token comment" spellcheck="true">// 继承React.PureComponent的时候，视图更新通过数据源的内存地址判断完成</span>
<span class="token keyword">class</span> <span class="token class-name">ListOfWords</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>PureComponent</span><span class="token operator">&lt;</span>IProps<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// shouldComponentUpdate(nextProps: IProps) {</span>
  <span class="token comment" spellcheck="true">//   console.log(nextProps.words,"0000000000000000000000")</span>
  <span class="token comment" spellcheck="true">//   return true;</span>
  <span class="token comment" spellcheck="true">// }</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"render"</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>words<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> ListOfWords


<span class="token comment" spellcheck="true">//App.tsx</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> SFC<span class="token punctuation">,</span> useState<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> ListOfWords <span class="token keyword">from</span> <span class="token string">'./components4/ListOfWords'</span>

<span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span> words<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'marklar'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
type IState <span class="token operator">=</span> Readonly<span class="token operator">&lt;</span><span class="token keyword">typeof</span> initialState<span class="token operator">></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  readonly state<span class="token punctuation">:</span> IState <span class="token operator">=</span> initialState<span class="token punctuation">;</span>

  handleClick <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 当ListOfWords组件继承React.PureComponent的时候，下面的代码不会触发视图的刷新，因为当前的words虽然修改了，但总是引用同一块内存</span>
    <span class="token comment" spellcheck="true">// this.setState((prev:IState)=>{</span>
    <span class="token comment" spellcheck="true">//   prev.words.push("marklar")</span>
    <span class="token comment" spellcheck="true">//   return {</span>
    <span class="token comment" spellcheck="true">//     words:prev.words</span>
    <span class="token comment" spellcheck="true">//   }</span>
    <span class="token comment" spellcheck="true">// })</span>


    <span class="token comment" spellcheck="true">//下面代码会触发ListOfWords视图更新，因为每次点击按钮都给words赋值一个新的数组，此时新数组和原来数组的内存地址肯定不一致，从而组件才可能更新</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span>prev<span class="token punctuation">:</span>IState<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
      prev<span class="token punctuation">.</span>words<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"marklar"</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        words<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token operator">...</span>prev<span class="token punctuation">.</span>words<span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>div<span class="token operator">></span>
      这是App组件
      <span class="token operator">&lt;</span>ListOfWords words<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>words<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>ListOfWords<span class="token operator">></span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">}</span><span class="token operator">></span>添加words<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/*
1.继承Component时，数据源发生变化之后，会通过shouldComponentUpdate的返回值来判断页面是否需要刷新
2.继承PureComponent时，数据源发生变化之后，默认进行的是浅比较(只会比较数据的内存地址是否一致)，不能再重写shouldComponentUpdate
*/</span></code></pre>
<h2 id="6-4-getDerivedStateFromProps存在的问题"><a href="#6-4-getDerivedStateFromProps存在的问题" class="headerlink" title="6.4 getDerivedStateFromProps存在的问题"></a>6.4 getDerivedStateFromProps存在的问题</h2><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//getDerivedStateFromProps 函数会在每次re-rendering之前被调用</span>

<span class="token comment" spellcheck="true">//为什么要用getDerivedStateFromProps？答案：组件接收的props数据是只读的，我们可以使用该方法将传递的props映射到state里面，实现修改(会有诸多问题)</span>
<span class="token comment" spellcheck="true">//注意点：该方法是一个静态方法，方法中没有this，故而不可以直接通过this.setState()来改变状态，而是需要通过return来改变状态</span>

<span class="token comment" spellcheck="true">//参数：</span>
<span class="token comment" spellcheck="true">//1.nextProps外部传递过来的props属性</span>
<span class="token comment" spellcheck="true">//2.prevState之前的state状态</span>

<span class="token keyword">static</span> <span class="token function">getDerivedStateFromProps</span><span class="token punctuation">(</span>nextProps<span class="token punctuation">,</span> prevState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"getDerivedStateFromProps"</span><span class="token punctuation">,</span> nextProps<span class="token punctuation">,</span> prevState<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">//获取到父组件中传递过来的initcount值</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> initcount <span class="token punctuation">}</span> <span class="token operator">=</span> nextProps<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//当父组件中传递过来的initcount发生改变了</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>initcount <span class="token operator">!=</span> prevState<span class="token punctuation">.</span>prevCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//在方法中返回{count:initcount} 替换掉当前state中的 count值</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            count<span class="token punctuation">:</span> initcount<span class="token punctuation">,</span>
            prevCount<span class="token punctuation">:</span>initcount
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true">//如果props传入的内容不需要影响到你的state，那么就需要返回一个null</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span>


<span class="token comment" spellcheck="true">//问题：</span>
<span class="token number">1</span><span class="token punctuation">.</span>当前组件的状态由多个源控制，父组件中控制列表数据，子组件中又控制了type这个state。
因此父组件state改掉之后，会触发子组件重新渲染；本身组件state改掉之后，会触发当前组件重新渲染

<span class="token number">2</span><span class="token punctuation">.</span>如果你的组件内部既需要修改自己的type，又需要接收从外部修改的type。逻辑非常混乱！getDerivedStateFromProps中你根本不知道该做什么。

<span class="token keyword">if</span> <span class="token punctuation">(</span>initcount <span class="token operator">!=</span> prevState<span class="token punctuation">.</span>prevCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//在方法中返回{count:initcount} 替换掉当前state中的 count值</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        count<span class="token punctuation">:</span> initcount<span class="token punctuation">,</span>
        prevCount<span class="token punctuation">:</span>initcount
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

如果彻底解决这个问题呢？
<span class="token function">答案：好好组织你的组件，在非必须的时候，摒弃这种写法</span><span class="token punctuation">(</span>派生属性<span class="token punctuation">)</span>。type要么由props驱动，要么完全由state驱动。

从这个生命周期的更新来看，react更希望将受控的props和state进行分离，就如同Redux作者Dan Abramov在redux文档当中写的一样Presentational and Container Components，将所有的组件分离称为展示型组件和容器型组件，一个只负责接收props来改变自己的样式，一个负责保持其整个模块的state。这样可以让代码更加清晰。但是在实际的业务逻辑中，我们有时很难做到这一点，而且这样可能会导致容器型组件变得非常庞大以致难以管理，如何进行取舍还是需要根据实际场景决定的</code></pre>
<h2 id="6-5-React老版本生命周期"><a href="#6-5-React老版本生命周期" class="headerlink" title="6.5 React老版本生命周期"></a>6.5 React老版本生命周期</h2><p><img src="https://i.loli.net/2020/11/09/Sm2VnMoJpdkhTYC.png" alt="3284159097-5bbb08d17db33_articlex-1584956954768.png"></p>
<h1 id="7-函数组件的生命周期"><a href="#7-函数组件的生命周期" class="headerlink" title="7.函数组件的生命周期"></a>7.函数组件的生命周期</h1><h2 id="7-1-useEffect介绍"><a href="#7-1-useEffect介绍" class="headerlink" title="7.1 useEffect介绍"></a>7.1 useEffect介绍</h2><p><code>useEffect</code> 就是一个 Effect Hook，给函数组件增加了操作副作用的能力。它跟 class 组件中的 <code>componentDidMount</code>、<code>componentDidUpdate</code> 和 <code>componentWillUnmount</code> 具有相同的用途，只不过被合并成了一个 API。</p>
<p>在调用这个hook时，就是告诉React在完成对DOM的更改后运行这个hook，在这里你可以访问到state和props。</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token operator">-</span> 纯函数：如果函数的调用参数相同，则永远返回相同的结果。它不依赖于程序执行期间函数外部任何状态或数据的变化，必须只依赖于其输入参数。
    <span class="token keyword">function</span> <span class="token function">priceAfterTax</span><span class="token punctuation">(</span>productPrice<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        <span class="token keyword">return</span> <span class="token punctuation">(</span>productPrice <span class="token operator">*</span> <span class="token number">0.20</span><span class="token punctuation">)</span> <span class="token operator">+</span> productPrice<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token operator">-</span> 副作用：一个可以被观察的副作用是在函数内部与其外部的任意交互。这可能是在函数内修改外部的变量，或者在函数里调用另外一个函数等。
    <span class="token keyword">var</span> tax <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">calculateTax</span><span class="token punctuation">(</span>productPrice<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        tax <span class="token operator">=</span> tax<span class="token operator">/</span><span class="token number">100</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>productPrice <span class="token operator">*</span> tax<span class="token punctuation">)</span> <span class="token operator">+</span> productPrice<span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre>
<h2 id="7-2-useEffect用法"><a href="#7-2-useEffect用法" class="headerlink" title="7.2 useEffect用法"></a>7.2 useEffect用法</h2><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//1  componentDidMount执行一次，依赖项每次改变时执行一次</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//副作用动作</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span>依赖项<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">//2  相当于componentDidMount</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//副作用动作</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">//3  相当于componentDidMount 、componentDidUpdate</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//副作用动作</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<h2 id="7-3-useEffect使用"><a href="#7-3-useEffect使用" class="headerlink" title="7.3 useEffect使用"></a>7.3 useEffect使用</h2><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>

type IProps <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">const</span> Demo2<span class="token punctuation">:</span> FC<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IProps</span><span class="token punctuation">></span></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">//count代表state的变量</span>
  <span class="token comment" spellcheck="true">//setCount是一个function，如果我们要修改count变量，需要通过setCount来修改</span>
  <span class="token keyword">let</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> useState<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> <span class="token punctuation">[</span>count2<span class="token punctuation">,</span> setCount2<span class="token punctuation">]</span> <span class="token operator">=</span> useState<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

  <span class="token comment" spellcheck="true">//useEffect函数可以来模拟class组件的中指定生命周期的钩子函数 componentDidMount，componentDidUpdate，componentWillUnmount</span>

  <span class="token comment" spellcheck="true">//相当于componentDidMount 、componentDidUpdate</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"xxxxxxxxxxx"</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment" spellcheck="true">//相当于componentDidMount</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"yyyyyyyyy"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token comment" spellcheck="true">//相当于componentDidMount 和 当count2的值被改变之后执行当前的useEffect</span>
  <span class="token comment" spellcheck="true">//其他值改变不会执行这个useEffect</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"zzzzzzzzzzzzz"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>count2<span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>
    count的值是：<span class="token punctuation">{</span>count<span class="token punctuation">}</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span> <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token operator">++</span>count<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span>点我修改count<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span>
    count2的值是<span class="token punctuation">:</span><span class="token punctuation">{</span>count2<span class="token punctuation">}</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span> <span class="token function">setCount2</span><span class="token punctuation">(</span><span class="token operator">++</span>count2<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span>点我修改count2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Demo2<span class="token punctuation">;</span></code></pre>
<h2 id="7-4-清除副作用"><a href="#7-4-清除副作用" class="headerlink" title="7.4 清除副作用"></a>7.4 清除副作用</h2><h3 id="a-无需清理的副作用"><a href="#a-无需清理的副作用" class="headerlink" title="a) 无需清理的副作用"></a>a) 无需清理的副作用</h3><blockquote>
<p>有时候，我们只想<strong>在 React 更新 DOM 之后运行一些额外的代码。</strong>比如发送网络请求，手动变更 DOM，记录日志，这些都是常见的无需清除的操作。因为我们在执行完这些操作之后，就可以忽略他们了。</p>
</blockquote>
<p>需求：监听url的变化来发送网络请求，保存返回结果</p>
<pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ajax <span class="token keyword">from</span> <span class="token string">'@utils/ajax'</span>

type IProps <span class="token operator">=</span> <span class="token punctuation">{</span>
  location<span class="token punctuation">:</span>string
<span class="token punctuation">}</span>

<span class="token keyword">const</span> Example<span class="token punctuation">:</span> FC<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IProps</span><span class="token punctuation">></span></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>props<span class="token punctuation">.</span>location<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> getData <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    ajax<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
      <span class="token function">setData</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>data<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Example<span class="token punctuation">;</span></code></pre>
<p>当location发生变化时，useEffect中函数就会自动执行</p>
<h3 id="b-需要清理的副作用"><a href="#b-需要清理的副作用" class="headerlink" title="b) 需要清理的副作用"></a>b) 需要清理的副作用</h3><blockquote>
<p>之前我们研究了如何使用不需要清除的副作用，还有一些副作用是需要清除的。例如<strong>定时器</strong>、<strong>订阅外部数据源</strong>。这种情况下，清除工作是非常重要的，可以防止引起内存泄露！</p>
</blockquote>
<p>在useEffect中可选的返回一个清除函数，该清除函数会在组件<strong>卸载</strong>时自动执行，以达到清除effect的目的；</p>
<pre class=" language-jsx"><code class="language-jsx"><span class="token comment" spellcheck="true">//useEffect函数中return的function会在组件卸载时自动执行</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//副作用动作</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//清除effect</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>使用示例</p>
<pre class=" language-jsx"><code class="language-jsx"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"useEffect在组件挂载和更新的时候执行"</span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"定时器打印"</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//如果useEffect的function中返回了一个函数，那么该函数会在组件卸载的时候执行</span>
        <span class="token comment" spellcheck="true">//就相当于componentWillUnMount</span>
        <span class="token comment" spellcheck="true">//现在每一次重新渲染都会返回一个新的清除函数，把上一次组件装在执行的定时器清除掉(这边由于闭包的原因，之前的定时器以及一些变量都会被释放)</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"清除定时器"</span><span class="token punctuation">)</span>  
            timer <span class="token operator">&amp;&amp;</span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<h3 id="c-useEffect返回清除函数的执行时机"><a href="#c-useEffect返回清除函数的执行时机" class="headerlink" title="c) useEffect返回清除函数的执行时机"></a>c) useEffect返回清除函数的执行时机</h3><p>这里是组件<strong>卸载</strong>时自动执行，当前状态下的函数组件render完之后会立即执行上一个函数状态中<code>useEffect</code>返回的清除函数，而这个清除函数中所带的参数也是处于上一个状态中（闭包的特性）。</p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000018639033">https://segmentfault.com/a/1190000018639033</a></p>
<blockquote>
<p>假设在组件的使用过程中，外部传入的props参数id，改变了两次，第一次传入<code>id: 1</code>， 第二次传入<code>id: 2</code></p>
<p>那么我们来梳理一下整个过程：</p>
<ol>
<li>传入<code>props.id = 1</code></li>
<li>组件渲染</li>
<li>DOM渲染完成，useEffect逻辑执行，返回清除副作用函数<code>clear，</code>命名为<code>clear1</code></li>
<li>传入<code>props.id = 2</code></li>
<li>组件渲染</li>
<li>组件渲染完成，clear1执行</li>
<li>useEffect逻辑执行，返回另一个clear函数，命名为<code>clear2</code></li>
<li>组件卸载，clear2执行</li>
</ol>
<p>执行过程有点绕，因为与你印象中的执行过程似乎不一样。其实关键的地方就在于clear函数的执行，它的特征如下：</p>
<ul>
<li>每次useEffect执行，都会返回一个新的clear函数</li>
<li>clear函数会在下一次useEffect逻辑之前执行（DOM渲染完成之后）</li>
<li>组件卸载也会执行一次</li>
</ul>
</blockquote>
<h2 id="7-5-useLayoutEffect"><a href="#7-5-useLayoutEffect" class="headerlink" title="7.5 useLayoutEffect"></a>7.5 useLayoutEffect</h2><pre class=" language-jsx"><code class="language-jsx"><span class="token function">useLayoutEffect</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> 依赖项 <span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>其函数签名与 <code>useEffect</code> 相同，但它会在所有的 DOM 变更之后<strong>同步调用</strong> effect。可以使用它来读取 DOM 布局并同步触发重渲染。</p>
<p>这个是用在处理DOM的时候，当你的useEffect里面的操作需要处理DOM。并且会改变页面的样式，就需要用这个，否则可能会出现出现闪屏问题</p>
<p><a target="_blank" rel="noopener" href="https://cllxx.cn/2019/07/21/react-xin-te-xing-hooks-zhi-useeffect-he-uselayouteffect-wu/">https://cllxx.cn/2019/07/21/react-xin-te-xing-hooks-zhi-useeffect-he-uselayouteffect-wu/</a></p>
<blockquote>
<p>useEffect和useLayoutEffect的异同：</p>
<ul>
<li>useLayoutEffect是在虚拟DOM构建完成后立即执行，useEffect是在真实DOM构建完成后立即执行</li>
</ul>
<ul>
<li>useLayoutEffect是同步执行，useEffect是异步执行</li>
</ul>
</blockquote>
<h2 id="7-6-useEffect使用注意点"><a href="#7-6-useEffect使用注意点" class="headerlink" title="7.6 useEffect使用注意点"></a>7.6 useEffect使用注意点</h2><p>useEffect的函数需要返回一个cleanup的清除函数或者undefined。而当我们使用await、async的时候，会默认返回一个Promise，所以我们不能在useEffect函数中使用async</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//错误</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
     <span class="token keyword">await</span> <span class="token function">fetchSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//正确</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> <span class="token function">fetchSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h1 id="8-其他常用hook"><a href="#8-其他常用hook" class="headerlink" title="8.其他常用hook"></a>8.其他常用hook</h1><h2 id="8-1-函数组件re-render的时机"><a href="#8-1-函数组件re-render的时机" class="headerlink" title="8.1 函数组件re-render的时机"></a>8.1 函数组件re-render的时机</h2><blockquote>
<ol>
<li>组件重新被创建</li>
<li>当前组件state的内存地址发生了变化，无论dom中是否使用了state</li>
<li>父组件更新，子组件也会自动的更新</li>
<li>组件更新时，会卸载所有function，并重新创建function (执行函数组件的所有逻辑)</li>
</ol>
</blockquote>
<p>也就是说，在函数组件中，只要父组件或者当前组件的state内存地址发生变化，都会触发当前组件以及当前组件的子组件re-render，无论当前组件是否使用到父组件中的state。</p>
<p>而在函数组件中，react不再区分mount和update两个状态，这意味着函数组件的每一次调用都会执行其内部的所有逻辑，那么会带来较大的性能损耗。因此useMemo 和useCallback就是解决性能问题的杀手锏。</p>
<h2 id="8-2-memo-useMemo-useCallback"><a href="#8-2-memo-useMemo-useCallback" class="headerlink" title="8.2 memo\useMemo\useCallback"></a>8.2 memo\useMemo\useCallback</h2><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//Child.tsx</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Child<span class="token punctuation">:</span> FC<span class="token operator">&lt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token punctuation">{</span>date<span class="token punctuation">.</span><span class="token function">toLocaleString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Child<span class="token punctuation">;</span>


<span class="token comment" spellcheck="true">//Parent.tsx</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span>useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> Child <span class="token keyword">from</span> <span class="token string">"./Child"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Parent<span class="token punctuation">:</span>FC<span class="token operator">&lt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span>setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>div<span class="token operator">></span>数量为<span class="token punctuation">:</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token function">setCount</span><span class="token punctuation">(</span>count<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>点我加<span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&lt;</span>Child<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Child<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Parent<span class="token punctuation">;</span>


<span class="token comment" spellcheck="true">//index.tsx</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>div<span class="token operator">></span>
  <span class="token operator">&lt;</span>Parent<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Parent<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token comment" spellcheck="true">//案例存在的问题：每点击一次按钮，会重新渲染一次时间，说明父组件更新的时候，子组件也重新渲染了</span></code></pre>
<h3 id="8-2-1-使用memo高阶函数"><a href="#8-2-1-使用memo高阶函数" class="headerlink" title="8.2.1 使用memo高阶函数"></a>8.2.1 使用memo高阶函数</h3><p><code>React.memo()</code>是一个高阶函数，它与 <a target="_blank" rel="noopener" href="https://reactjs.org/docs/react-api.html#reactpurecomponent"><code>React.PureComponent</code></a>类似，是一个函数组件而非一个类。</p>
<p>React.memo()可接受2个参数，第一个参数为纯函数的组件，第二个参数用于对比props控制是否刷新，与<a target="_blank" rel="noopener" href="https://reactjs.org/docs/react-component.html#shouldcomponentupdate"><code>shouldComponentUpdate()</code></a>功能类似</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//Child.tsx</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span>memo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Child<span class="token punctuation">:</span> FC<span class="token operator">&lt;</span><span class="token punctuation">{</span>count<span class="token operator">?</span><span class="token punctuation">:</span>number<span class="token punctuation">}</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token function">memo</span><span class="token punctuation">(</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token punctuation">{</span>date<span class="token punctuation">.</span><span class="token function">toLocaleString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span>prev<span class="token punctuation">,</span>next<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>prev<span class="token punctuation">.</span>count<span class="token punctuation">,</span>next<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> prev<span class="token punctuation">.</span>count<span class="token operator">==</span>next<span class="token punctuation">.</span>count <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment" spellcheck="true">//这边只要父亲传递给孩子的props发生了变化就应该刷新子组件(如果父亲没有给子组件传递props或者父亲给子组件传递的props没有改变，则子组件不应该刷新)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Child<span class="token punctuation">;</span>


<span class="token comment" spellcheck="true">//Parent.tsx</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span>useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> Child <span class="token keyword">from</span> <span class="token string">"./Child"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Parent<span class="token punctuation">:</span>FC<span class="token operator">&lt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span>setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>div<span class="token operator">></span>数量为<span class="token punctuation">:</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token function">setCount</span><span class="token punctuation">(</span>count<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>点我加<span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&lt;</span>Child count<span class="token operator">=</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Child<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Parent<span class="token punctuation">;</span></code></pre>
<h3 id="8-2-2-useMemo"><a href="#8-2-2-useMemo" class="headerlink" title="8.2.2 useMemo"></a>8.2.2 useMemo</h3><h4 id="a-没有使用useMemo存在的问题"><a href="#a-没有使用useMemo存在的问题" class="headerlink" title="a) 没有使用useMemo存在的问题"></a>a) 没有使用useMemo存在的问题</h4><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//Parent.tsx</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Child <span class="token keyword">from</span> <span class="token string">"./Child"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Parent<span class="token punctuation">:</span> FC<span class="token operator">&lt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">"zhangsan"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>div<span class="token operator">></span>数量为<span class="token punctuation">:</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>button
        onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
          <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">></span>
        点我加<span class="token number">1</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&lt;</span>Child obj<span class="token operator">=</span><span class="token punctuation">{</span>obj<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Child<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Parent<span class="token punctuation">;</span>



<span class="token comment" spellcheck="true">//Child.tsx</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span> memo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Child<span class="token punctuation">:</span> FC<span class="token operator">&lt;</span><span class="token punctuation">{</span> obj<span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token operator">?</span><span class="token punctuation">:</span> string <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token function">memo</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token punctuation">{</span>date<span class="token punctuation">.</span><span class="token function">toLocaleString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span>prev<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> prev<span class="token punctuation">.</span>obj <span class="token operator">==</span> next<span class="token punctuation">.</span>obj<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Child<span class="token punctuation">;</span>



<span class="token comment" spellcheck="true">//案例存在的问题：每点击一次按钮，会重新渲染一次时间，但是每一次点击按钮的时候，父组件给子组件传递的都是相同的obj对象，为什么子组件还是会刷新呢?</span>
<span class="token comment" spellcheck="true">//原因是每一次点击按钮的时候，会重新刷新父组件，父组件中的obj会重新被实例化，所以新实例化的obj和上一次实例化的obj不是同一个对象</span></code></pre>
<h4 id="b-useMemo-hook"><a href="#b-useMemo-hook" class="headerlink" title="b) useMemo hook"></a>b) useMemo hook</h4><p>useMemo可以用来缓存一些变量，并指定哪些条件变化后重新计算缓存的变量。</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> memoizedValue <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">computeExpensiveValue</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<blockquote>
<p>useMemo第一个参数是一个 factory 函数，该函数的返回结果会通过useMemo缓存下来</p>
<p>​                  第二个参数是factory函数的依赖(deps)，当依赖(deps)改变时才重新执行 factory 函数，memoizedValue 才会被重新计算</p>
</blockquote>
<p>也就是在依赖未改变时（或空数组无依赖时），memoizedValue 总是返回通过useMemo缓存的值。</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//Parent.tsx</span>

<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span> useState<span class="token punctuation">,</span>useMemo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Child <span class="token keyword">from</span> <span class="token string">"./Child"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Parent<span class="token punctuation">:</span> FC<span class="token operator">&lt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">//使用useMemo缓存变量值  依赖项没有指定</span>
  <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      name<span class="token punctuation">:</span> <span class="token string">"zhangsan"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>div<span class="token operator">></span>数量为<span class="token punctuation">:</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>button
        onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
          <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">></span>
        点我加<span class="token number">1</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&lt;</span>Child obj<span class="token operator">=</span><span class="token punctuation">{</span>obj<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Child<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Parent<span class="token punctuation">;</span></code></pre>
<h3 id="8-2-3-useCallback"><a href="#8-2-3-useCallback" class="headerlink" title="8.2.3 useCallback"></a>8.2.3 useCallback</h3><h4 id="a-没有使用useCallback的问题"><a href="#a-没有使用useCallback的问题" class="headerlink" title="a) 没有使用useCallback的问题"></a>a) 没有使用useCallback的问题</h4><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//Parent.tsx</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span> useState<span class="token punctuation">,</span>useMemo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Child <span class="token keyword">from</span> <span class="token string">"./Child"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Parent<span class="token punctuation">:</span> FC<span class="token operator">&lt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>text<span class="token punctuation">,</span>setText<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> changeHandler <span class="token operator">=</span> <span class="token punctuation">(</span>event<span class="token punctuation">:</span>React<span class="token punctuation">.</span>ChangeEvent<span class="token operator">&lt;</span>HTMLInputElement<span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
    <span class="token function">setText</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>div<span class="token operator">></span>text文本为<span class="token punctuation">:</span><span class="token punctuation">{</span>text<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>Child onChange<span class="token operator">=</span><span class="token punctuation">{</span>changeHandler<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Child<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Parent<span class="token punctuation">;</span>


<span class="token comment" spellcheck="true">//Child.tsx</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span> memo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Child<span class="token punctuation">:</span> FC<span class="token operator">&lt;</span><span class="token punctuation">{</span>
  onChange<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>event<span class="token punctuation">:</span> React<span class="token punctuation">.</span>ChangeEvent<span class="token operator">&lt;</span>HTMLInputElement<span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token function">memo</span><span class="token punctuation">(</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token punctuation">{</span>date<span class="token punctuation">.</span><span class="token function">toLocaleString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>onChange<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>input<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Child<span class="token punctuation">;</span>


<span class="token comment" spellcheck="true">//上面代码中，我们在子组件中修改文本框的值，会触发子组件的onChange，从而触发父组件的changeHandler方法，在父组件中的changeHandler方法中修改了text文本，所以页面上的text值发生了改变。 </span>
<span class="token comment" spellcheck="true">//但是除了我们发现页面上text文本改变之外，子组件中的时间也发生了改变 (说明每一次子组件输入内容的时候都会触发子组件的重新渲染)</span>
<span class="token comment" spellcheck="true">//原因是每一次子组件输入内容，父组件的text文本发生变化，造成父组件被重新渲染，从而造成父组件传递给子组件的changeHandler方法(props)发生了变化，从而造成子组件的重新渲染</span></code></pre>
<h4 id="b-useCallback-hook"><a href="#b-useCallback-hook" class="headerlink" title="b) useCallback   hook"></a>b) useCallback   hook</h4><p>useMemo缓存的是值</p>
<p>useCallback缓存的是函数。有两个参数，第一个参数是需要缓存的函数，第二个参数是依赖项。</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//Parent.tsx</span>

<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span> useState<span class="token punctuation">,</span>useCallback <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Child <span class="token keyword">from</span> <span class="token string">"./Child"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Parent<span class="token punctuation">:</span> FC<span class="token operator">&lt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>text<span class="token punctuation">,</span>setText<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>
  <span class="token comment" spellcheck="true">//使用useCallback缓存函数</span>
  <span class="token keyword">const</span> changeHandler <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span>event<span class="token punctuation">:</span>React<span class="token punctuation">.</span>ChangeEvent<span class="token operator">&lt;</span>HTMLInputElement<span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
    <span class="token function">setText</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>div<span class="token operator">></span>text文本为<span class="token punctuation">:</span><span class="token punctuation">{</span>text<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>Child onChange<span class="token operator">=</span><span class="token punctuation">{</span>changeHandler<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Child<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Parent<span class="token punctuation">;</span></code></pre>
<h3 id="8-2-4-useMemo和useCallback的区别和联系"><a href="#8-2-4-useMemo和useCallback的区别和联系" class="headerlink" title="8.2.4 useMemo和useCallback的区别和联系"></a>8.2.4 useMemo和useCallback的区别和联系</h3><p>实际上<code>useCallback</code>是基于<code>useMemo</code>实现的</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">useCallback</span><span class="token punctuation">(</span>callback<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> callback<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<ol>
<li><code>useMemo</code>是返回<code>callback</code>执行后的结果</li>
<li><code>useCallback</code> 是直接返回被<code>useMemo</code>修饰的<code>callback</code>函数</li>
</ol>
<h2 id="8-3-useReducer和useContext"><a href="#8-3-useReducer和useContext" class="headerlink" title="8.3 useReducer和useContext"></a>8.3 useReducer和useContext</h2><h3 id="8-3-1-useContext"><a href="#8-3-1-useContext" class="headerlink" title="8.3.1 useContext"></a>8.3.1 useContext</h3><blockquote>
<p>跨级组件通信，实现同一子树下所有节点可统一共享子树根节点的数据</p>
</blockquote>
<p>useContext接收一个 context 对象（<code>React.createContext</code> 的返回值）并返回该 context 的当前值。当前的 context 值由上层组件中距离当前组件最近的 <code>&lt;MyContext.Provider&gt;</code> 的 <code>value</code> 决定。</p>
<p>当组件上层最近的 <code>&lt;MyContext.Provider&gt;</code> 更新时，该 Hook 会触发重渲染，并使用最新传递给 <code>MyContext</code> provider 的 context <code>value</code> 值。</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>MyContext<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>基本用法：</p>
<pre class=" language-jsx"><code class="language-jsx">#<span class="token number">1</span><span class="token punctuation">.</span>index<span class="token punctuation">.</span>jsx
<span class="token keyword">import</span> MyContext <span class="token keyword">from</span> <span class="token string">'./context.js'</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MyContext.Provider</span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">"zhangsan"</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Parent</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Parent</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>MyContext.Provider</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


#<span class="token number">2</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>js
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">let</span> context <span class="token operator">=</span> createContext<span class="token operator">&lt;</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> string <span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">""</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> MyContext<span class="token punctuation">;</span>


#<span class="token number">3</span><span class="token punctuation">.</span>Parent<span class="token punctuation">.</span>jsx
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span>useContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> MyContext <span class="token keyword">from</span> <span class="token string">'../context.js'</span>

<span class="token keyword">const</span> Parent<span class="token punctuation">:</span> FC<span class="token operator">&lt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">//在子组件中获取根组件暴露的数据</span>
  <span class="token keyword">const</span> contextValue <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>MyContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>contextValue<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>text文本为<span class="token punctuation">:</span><span class="token punctuation">{</span>contextValue<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Parent<span class="token punctuation">;</span></code></pre>
<h3 id="8-3-2-useReducer"><a href="#8-3-2-useReducer" class="headerlink" title="8.3.2 useReducer"></a>8.3.2 useReducer</h3><h4 id="a-redux介绍"><a href="#a-redux介绍" class="headerlink" title="a) redux介绍"></a>a) redux介绍</h4><p>Redux是SPA单页面应用程序中多个组件之间共享数据的一种方式。</p>
<p><img src="https://i.loli.net/2020/11/09/Z6bCnEoLaGxBYIK.png" alt="1602462149160.png"></p>
<pre><code>- store：共享的state数据。
- reducers：纯函数，用于修改state，由action触发。
- action：一个对象，是 reducers的触发器，通过dispatch来触发，action对象需要有type字段
- dispatch：派发器， dispatch函数接受一个action对象作为入参。action对象需要有type字段</code></pre>
<h4 id="b-useReducer"><a href="#b-useReducer" class="headerlink" title="b) useReducer"></a>b) useReducer</h4><p>useReducer是在函数组件中实现类似 Redux 功能的一个Hook。他接收两个参数，第一个参数是一个recuder(纯函数)，第二个参数是state的初始值。</p>
<p>他返回一个状态 state和 dispath，state是返回状态中的值，而 dispatch 是一个可以发布事件来更新 state 的。</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// reducer 纯函数，用于修改state</span>
<span class="token comment" spellcheck="true">// initialArg 初始化的state状态</span>
<span class="token comment" spellcheck="true">// init 一个函数用于惰性计算state初始值</span>
<span class="token comment" spellcheck="true">// state 获取state数据</span>
<span class="token comment" spellcheck="true">// dispatch 派发器，用于接收一个action来触发reducer，从而修改state</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialArg<span class="token punctuation">,</span> init<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="8-3-3-useReducer和useContext-了解"><a href="#8-3-3-useReducer和useContext-了解" class="headerlink" title="8.3.3 useReducer和useContext(了解)"></a>8.3.3 useReducer和useContext(了解)</h3><p>在函数组件中，useReducer和useContext结合使用的时候可以提供类似Vuex那样的全局状态管理</p>
<p>useContext负责向子孙组件暴露数据</p>
<p>useReducer提供全局的state、reducers、dispatch等 (useReducer必须要在函数组件中才能使用，所以这边得把代码放到App.tsx中)</p>
<pre class=" language-javascript"><code class="language-javascript">#<span class="token number">1</span><span class="token punctuation">.</span>index<span class="token punctuation">.</span>tsx
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>App<span class="token operator">></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

#<span class="token number">2</span><span class="token punctuation">.</span>App<span class="token punctuation">.</span>tsx
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useContext<span class="token punctuation">,</span> useReducer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">"./App.css"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Parent4 <span class="token keyword">from</span> <span class="token string">"./components4/Parent4"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> MyContext4<span class="token punctuation">,</span> <span class="token punctuation">{</span> ActionType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./components4/MyContext4"</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//reducer是一个纯函数，可以将action的变化转换为state的变化</span>
<span class="token comment" spellcheck="true">//所以reducer纯函数需要接收一个action</span>
<span class="token keyword">const</span> reducer <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>state <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> action<span class="token punctuation">:</span> ActionType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">//根据action的type来修改state</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">"ADD"</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> state <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">"SUB"</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> state <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">"ADDN"</span><span class="token punctuation">:</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>step<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> num <span class="token operator">=</span> action<span class="token punctuation">.</span>step<span class="token punctuation">.</span>num<span class="token punctuation">;</span>
        <span class="token keyword">return</span> state <span class="token operator">+</span> num<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//useContext的作用是给子孙组件提供数据</span>
<span class="token comment" spellcheck="true">//useReducer的作用提供全局的状态管理</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token punctuation">[</span>count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>MyContext4<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span>count<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>Parent4<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Parent4<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>MyContext4<span class="token punctuation">.</span>Provider<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>


#<span class="token number">3</span><span class="token punctuation">.</span>Parent<span class="token punctuation">.</span>tsx
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span> useContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Child4 <span class="token keyword">from</span> <span class="token string">"./Child4"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> MyContext4 <span class="token keyword">from</span> <span class="token string">"./MyContext4"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Parent4<span class="token punctuation">:</span> FC <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span>dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>MyContext4<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> clickHandler1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//通过派发器来接收一个action，从而触发reducer的执行，会根据对应的action执行对应的数据修改逻辑</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token string">"ADD"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> clickHandler2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token string">"SUB"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> clickHandler3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token string">"ADDN"</span><span class="token punctuation">,</span>
      step<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        num<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>h3<span class="token operator">></span>Parent组件<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span>
      <span class="token operator">&lt;</span>p<span class="token operator">></span>当前count <span class="token punctuation">:</span> <span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>clickHandler1<span class="token punctuation">}</span><span class="token operator">></span>点我<span class="token operator">+</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>clickHandler2<span class="token punctuation">}</span><span class="token operator">></span>点我<span class="token operator">-</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>clickHandler3<span class="token punctuation">}</span><span class="token operator">></span>点我<span class="token operator">+</span><span class="token number">5</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&lt;</span>Child4<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Child4<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Parent4<span class="token punctuation">;</span>


#<span class="token number">4</span><span class="token punctuation">.</span>Child<span class="token punctuation">.</span>tsx
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC<span class="token punctuation">,</span> useContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> MyContext4 <span class="token keyword">from</span> <span class="token string">"./MyContext4"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Child4<span class="token punctuation">:</span> FC <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>MyContext4<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> clickHandler <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token punctuation">:</span><span class="token string">"ADD"</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>h3<span class="token operator">></span>Child子组件<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span>
      <span class="token operator">&lt;</span>p<span class="token operator">></span>当前数量<span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>clickHandler<span class="token punctuation">}</span><span class="token operator">></span>点我修改数量<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Child4<span class="token punctuation">;</span>


#<span class="token number">5</span><span class="token punctuation">.</span>MyContext<span class="token punctuation">.</span>tsx
<span class="token comment" spellcheck="true">//创建一个上下文对象，该对象会在useContext中使用到</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createContext<span class="token punctuation">,</span> Dispatch<span class="token punctuation">,</span> ReducerAction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//声明Action的泛型</span>
<span class="token keyword">export</span> type ActionType <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> string<span class="token punctuation">;</span>
  step<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    num<span class="token punctuation">:</span> number<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//声明Context的泛型</span>
type ContextType <span class="token operator">=</span> <span class="token punctuation">[</span>
  number<span class="token punctuation">,</span>
  Dispatch<span class="token operator">&lt;</span>ActionType<span class="token operator">></span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//创建一个context上下文，并导出</span>
<span class="token keyword">let</span> context <span class="token operator">=</span> createContext<span class="token operator">&lt;</span>ContextType<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> context<span class="token punctuation">;</span></code></pre>
<p>useReducer和useContext的出现并不是为了取代redux，redux是独立于任何第三方库，redux有优秀的中间件(异步数据流、debug)。当状态比较简单的时候，我们可以使用useReducer和useContext来实现组件之间的数据共享，但是当状态变得特别复杂的时候，建议使用redux。</p>
<h2 id="8-4-Hook的规则"><a href="#8-4-Hook的规则" class="headerlink" title="8.4 Hook的规则"></a>8.4 Hook的规则</h2><h3 id="8-4-1-只在组件顶层中使用Hook"><a href="#8-4-1-只在组件顶层中使用Hook" class="headerlink" title="8.4.1 只在组件顶层中使用Hook"></a>8.4.1 只在组件顶层中使用Hook</h3><blockquote>
<p><strong>不要在循环，条件或嵌套函数中调用 Hook，</strong> 确保总是在你的 React 函数的最顶层调用他们。遵守这条规则，你就能确保 Hook 在每一次渲染中都按照同样的顺序被调用。这让 React 能够在多次的 <code>useState</code> 和 <code>useEffect</code> 调用之间保持 hook 状态的正确。</p>
</blockquote>
<pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">Example</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//Yes</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// const [count, setCount] = useState(0); //No</span>
    <span class="token punctuation">}</span>

       <span class="token keyword">const</span> fn <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// const [count, setCount] = useState(0); //No</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token punctuation">}</span></code></pre>
<h3 id="8-4-2-只在React-函数中调用Hook"><a href="#8-4-2-只在React-函数中调用Hook" class="headerlink" title="8.4.2 只在React 函数中调用Hook"></a>8.4.2 只在React 函数中调用Hook</h3><blockquote>
<p><strong>不要在普通的 JavaScript 函数中调用 Hook。</strong>你可以：</p>
<ul>
<li>在 React 的函数组件中调用 Hook</li>
<li>在自定义 Hook 中调用其他 Hook</li>
<li>在class组件中不能使用Hook</li>
</ul>
<p>遵循此规则，确保组件的状态逻辑在代码中清晰可见。</p>
</blockquote>
<h2 id="8-5-Hook参照文章："><a href="#8-5-Hook参照文章：" class="headerlink" title="8.5 Hook参照文章："></a>8.5 Hook参照文章：</h2><ol>
<li><a target="_blank" rel="noopener" href="https://react-1251415695.cos-website.ap-chengdu.myqcloud.com/docs/getting-started.html">React官方文档</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/sinat_17775997/article/details/94453167">useMemo与useCallback使用指南</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/gtLBTNq9mr3/article/details/93984397">useReducerde使用和原理</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000021133222">五个大型项目实践总结，解密React Hooks最佳实践</a></li>
<li><a target="_blank" rel="noopener" href="https://overreacted.io/zh-hans/a-complete-guide-to-useeffect/">useEffect完整指南</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/88135310">一文彻底搞懂 react hooks 的原理和实现</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/b9ac8fa849f1">React Hooks的原理</a></li>
</ol>
<h1 id="9-React-router"><a href="#9-React-router" class="headerlink" title="9. React-router"></a>9. React-router</h1><h2 id="9-1-前端路由的两种实现方案"><a href="#9-1-前端路由的两种实现方案" class="headerlink" title="9.1 前端路由的两种实现方案"></a>9.1 前端路由的两种实现方案</h2><ol>
<li><p>hash : hash原本的作用是为一个很长的文档页添加锚点信息，它自带不改变url刷新页面的功能，所以自然而然被用单页面应用程序中了。</p>
</li>
<li><p>history : 应该说history是主流的解决方案，浏览器的前进后退用的就是这个，它是window对象下的，以前的history提供的方法只能做页面之间的前进后退，如下：</p>
<pre class=" language-javascript"><code class="language-javascript">history<span class="token punctuation">.</span><span class="token function">go</span><span class="token punctuation">(</span>number<span class="token operator">|</span>URL<span class="token punctuation">)</span> 可加载历史列表中的某个具体的页面
history<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 可加载历史列表中的下一个 URL
history<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 可加载历史列表中的前一个 URL</code></pre>
<p>为了在不刷新浏览器的情况下，创建新的浏览记录并插入浏览记录队列中，html5新增了如下方法：</p>
<pre><code>1. history.pushState(state, title, url)
   添加一条历史记录， state用于传递参数，可以为空。title是设置历史记录的标题，可以为空。url是历史记录的URL，不可以为空。

2.history.replaceState(state, title, url)
将history堆栈中当前的记录替换成这里的url，参数同上。

这个特性后来用到了单页面应用中比如：vue-router，react-router-dom里面。</code></pre>
</li>
</ol>
<h2 id="9-2-Reac中的路由"><a href="#9-2-Reac中的路由" class="headerlink" title="9.2 Reac中的路由"></a>9.2 Reac中的路由</h2><p><code>&lt;Router&gt;</code>是React中实现路由最外层的容器，一般情况下我们不再需要直接使用它，而是使用在它基础之上封装的几个适用于不同环境的组件，react-router-dom的Router有四种：</p>
<table>
<thead>
<tr>
<th>Router</th>
<th>适用情况</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=https://reacttraining.com/react-router/web/api/BrowserRouter">BrowserRouter</a></td>
<td>react-router-dom扩展，利用HTML5 新增的history API (pushState, replaceState)，是web应用最常用的路由组件</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=https://reacttraining.com/react-router/web/api/HashRouter">HashRouter</a></td>
<td>react-router-dom扩展，利用window.location.hash，适用于低版本浏览器或者一些特殊情境</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=https://reacttraining.com/react-router/web/api/MemoryRouter">MemoryRouter</a></td>
<td>继承自react-router ，用户在地址栏看不到任何路径变化，一般用在测试或者非浏览器环境开发中</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=https://reacttraining.com/react-router/web/api/StaticRouter">StaticRouter</a></td>
<td>继承自react-router，某些页面从渲染出来以后没有多的交互，所以没有状态的变化需要存储，就可以使用静态路由，静态路由适用于服务器端</td>
</tr>
</tbody></table>
<p>一般我们很少会用到MemoryRouter和StaticRouter，在web应用中更多的是用   <code>react-router-dom</code>扩展出来的BrowserRouter和HashRouter，这两个就是我前面提到的前端路由的两种解决办法的各自实现。</p>
<h2 id="9-3-HashRouter的基本使用"><a href="#9-3-HashRouter的基本使用" class="headerlink" title="9.3 HashRouter的基本使用"></a>9.3 HashRouter的基本使用</h2><pre class=" language-javascript"><code class="language-javascript">yarn add react<span class="token operator">-</span>router react<span class="token operator">-</span>router<span class="token operator">-</span>dom @types<span class="token operator">/</span>react<span class="token operator">-</span>router<span class="token operator">-</span>dom

#<span class="token number">1</span><span class="token punctuation">.</span>main<span class="token punctuation">.</span>js 
<span class="token comment" spellcheck="true">// 1. 导入包</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span>

<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.jsx'</span>

<span class="token comment" spellcheck="true">// 使用 render 函数渲染 虚拟DOM</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>App<span class="token operator">></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


#<span class="token number">2</span><span class="token punctuation">.</span>App<span class="token punctuation">.</span>jsx
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// HashRouter 表示一个路由的跟容器，所有的路由相关的东西，都要包裹在 HashRouter 里面</span>
<span class="token comment" spellcheck="true">// Route 表示一个路由规则， 在 Route 上有两个比较重要的属性：path   component</span>
<span class="token comment" spellcheck="true">// Link 表示一个路由的链接 ，就好比 vue 中的 &lt;router-link to="">&lt;/router-link></span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> HashRouter<span class="token punctuation">,</span> Route<span class="token punctuation">,</span> Link <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span>

<span class="token keyword">import</span> Home <span class="token keyword">from</span> <span class="token string">'./components6/Home'</span>
<span class="token keyword">import</span> Movie <span class="token keyword">from</span> <span class="token string">'./components6/Movie'</span>
<span class="token keyword">import</span> About <span class="token keyword">from</span> <span class="token string">'./components6/About'</span>

<span class="token keyword">const</span> App<span class="token punctuation">:</span> FC<span class="token operator">&lt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// 当 使用 HashRouter 把 App 根组件的元素包裹起来之后，网站就已经启用路由了</span>
  <span class="token comment" spellcheck="true">// 在一个网站中，只需要使用 唯一的一次 &lt;HashRouter>&lt;/HashRouter> 就行了</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>HashRouter<span class="token operator">></span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>h1<span class="token operator">></span>这是网站的APP根组件<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>

      <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">"/home"</span><span class="token operator">></span>首页<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">></span><span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span><span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span>
      <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">"/movie/top250/10"</span><span class="token operator">></span>电影<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">></span><span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span><span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span>
      <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">"/about"</span><span class="token operator">></span>关于<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">></span>

      <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">></span>

      <span class="token punctuation">{</span><span class="token comment" spellcheck="true">/* Route 创建的标签，就是路由规则，其中 path 表示要匹配的路由，component 表示要展示的组件 */</span><span class="token punctuation">}</span>
      <span class="token punctuation">{</span><span class="token comment" spellcheck="true">/* 在 vue 中有个 router-view 的路由标签专门用来放置匹配到的路由组件的，但是在 react-router 中并没有类似于这样的标签，而是直接把 Route 标签当作的坑（占位符） */</span><span class="token punctuation">}</span>
      <span class="token punctuation">{</span><span class="token comment" spellcheck="true">/* Route 具有两种身份：1. 它是一个路由匹配规则； 2. 它是一个占位符，表示将来匹配到的组件都放到这个位置， 如果想让路由规则进行精确匹配，可以为 Route添加 exact 属性，表示启用精确匹配模式 */</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"/home"</span> component<span class="token operator">=</span><span class="token punctuation">{</span>Home<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Route<span class="token operator">></span>
      <span class="token punctuation">{</span><span class="token comment" spellcheck="true">/* 注意：默认情况下，路由中的规则是模糊匹配的，如果路由可以部分匹配成功，就会展示这个路由对应的组件 */</span><span class="token punctuation">}</span>
      <span class="token punctuation">{</span><span class="token comment" spellcheck="true">/* 如果要匹配参数，可以在匹配规则中使用 : 修饰符，表示这个位置匹配到的是参数 */</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"/movie/:type/:id"</span> component<span class="token operator">=</span><span class="token punctuation">{</span>Movie<span class="token punctuation">}</span> exact<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Route<span class="token operator">></span>
      <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"/about"</span> component<span class="token operator">=</span><span class="token punctuation">{</span>About<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Route<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>HashRouter<span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>

#<span class="token number">3</span><span class="token punctuation">.</span>components<span class="token operator">/</span>Home<span class="token punctuation">.</span>jsx    
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Home<span class="token punctuation">:</span>FC<span class="token operator">&lt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span>主页<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Home<span class="token punctuation">;</span>

#<span class="token number">4</span><span class="token punctuation">.</span> components<span class="token operator">/</span>Movie<span class="token punctuation">.</span>jsx 
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> RouteComponentProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span>

type ParamsProps <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token operator">?</span><span class="token punctuation">:</span> string <span class="token operator">|</span> undefined<span class="token punctuation">,</span>
  id<span class="token operator">?</span><span class="token punctuation">:</span> string <span class="token operator">|</span> undefined
<span class="token punctuation">}</span>
type IProps <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">?</span><span class="token punctuation">:</span> string
<span class="token punctuation">}</span>
<span class="token keyword">const</span> Movie<span class="token punctuation">:</span> FC<span class="token operator">&lt;</span>IProps <span class="token operator">&amp;</span> RouteComponentProps<span class="token operator">&lt;</span>ParamsProps<span class="token operator">></span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span>电影<span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">{</span>props<span class="token punctuation">.</span>match<span class="token punctuation">.</span>params<span class="token punctuation">.</span>type<span class="token punctuation">}</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">{</span>props<span class="token punctuation">.</span>match<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Movie<span class="token punctuation">;</span>

#<span class="token number">5</span><span class="token punctuation">.</span> components<span class="token operator">/</span>About<span class="token punctuation">.</span>jsx
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> About<span class="token punctuation">:</span>FC<span class="token operator">&lt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span>关于我们<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> About<span class="token punctuation">;</span></code></pre>
<h2 id="9-4-匹配规则"><a href="#9-4-匹配规则" class="headerlink" title="9.4 匹配规则"></a>9.4 匹配规则</h2><p><strong>默认：</strong></p>
<table>
<thead>
<tr>
<th>路径</th>
<th>location.pathname</th>
<th>是否匹配</th>
</tr>
</thead>
<tbody><tr>
<td>/one</td>
<td>/one</td>
<td>是</td>
</tr>
<tr>
<td>/one</td>
<td>/one/</td>
<td>是</td>
</tr>
<tr>
<td>/one</td>
<td>/one/111</td>
<td>是</td>
</tr>
<tr>
<td>/one</td>
<td>/one/aaa/bbb</td>
<td>是</td>
</tr>
</tbody></table>
<p><strong>exact配置：</strong>exact属性为true时路径中的hash值必须和path完全一致才渲染对应的组件，如果为false则’/‘也可以匹配’/xxx’</p>
<table>
<thead>
<tr>
<th>路径</th>
<th>location.pathname</th>
<th>exact</th>
<th>是否匹配</th>
</tr>
</thead>
<tbody><tr>
<td>/one</td>
<td>/one/two</td>
<td>true</td>
<td>否</td>
</tr>
<tr>
<td>/one</td>
<td>/one/two</td>
<td>false</td>
<td>是</td>
</tr>
</tbody></table>
<p><strong>strict配置：</strong>strict属性主要就是匹配反斜杠，规定是否匹配末尾包含反斜杠的路径，如果strict为true，则如果path中不包含反斜杠结尾，则他也不能匹配包含反斜杠结尾的路径</p>
<table>
<thead>
<tr>
<th>路径</th>
<th>location.pathname</th>
<th>strict</th>
<th>是否匹配</th>
</tr>
</thead>
<tbody><tr>
<td>/one/</td>
<td>/one</td>
<td>true</td>
<td>否</td>
</tr>
<tr>
<td>/one/</td>
<td>/one/</td>
<td>true</td>
<td>是</td>
</tr>
<tr>
<td>/one/</td>
<td>/one/two</td>
<td>true</td>
<td>是</td>
</tr>
</tbody></table>
<h2 id="9-5-Switch和Redirect"><a href="#9-5-Switch和Redirect" class="headerlink" title="9.5 Switch和Redirect"></a>9.5 Switch和Redirect</h2><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> HashRouter<span class="token punctuation">,</span> Route<span class="token punctuation">,</span> Link<span class="token punctuation">,</span> Switch<span class="token punctuation">,</span> Redirect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span>


<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>HashRouter<span class="token operator">></span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>h1<span class="token operator">></span>这是网站的APP根组件<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>

      <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">"/home"</span><span class="token operator">></span>首页<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">></span><span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span><span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span>
      <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">"/movie/top250/10"</span><span class="token operator">></span>电影<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">></span><span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span><span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span>
      <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">"/about"</span><span class="token operator">></span>关于<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">></span>

      <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">></span>


      <span class="token punctuation">{</span><span class="token comment" spellcheck="true">/*&lt;/Switch>
       Switch表示路由互斥，如果没有Switch，会根据路由找到所有匹配的组件显示
       比如http://localhost:3000/#/user  会找到/、/user所匹配的路由(下面home没有找到是因为精确匹配了)
    */</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span>Switch<span class="token operator">></span>
        <span class="token punctuation">{</span><span class="token comment" spellcheck="true">/*
        path:/ 表示访问根路径的情况下默认载入home组件
        exact精确匹配，为了给其他组件一个机会获取到url改变
        strict 在确定路径是否与当前URL匹配时，将考虑路径后的斜线；
       */</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"/home"</span> component<span class="token operator">=</span><span class="token punctuation">{</span>Home<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Route<span class="token operator">></span>
        <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"/movie/:type/:id"</span> component<span class="token operator">=</span><span class="token punctuation">{</span>Movie<span class="token punctuation">}</span> exact<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Route<span class="token operator">></span>
        <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"/about"</span> component<span class="token operator">=</span><span class="token punctuation">{</span>About<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Route<span class="token operator">></span>
        <span class="token punctuation">{</span><span class="token comment" spellcheck="true">/*没有匹配到路径的时候重定向到根路径*/</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span>Redirect to<span class="token operator">=</span><span class="token string">"/"</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Switch<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>HashRouter<span class="token operator">></span><span class="token punctuation">)</span></code></pre>
<h2 id="9-6-React中的编程式导航和路由传参"><a href="#9-6-React中的编程式导航和路由传参" class="headerlink" title="9.6 React中的编程式导航和路由传参"></a>9.6 React中的编程式导航和路由传参</h2><h3 id="9-6-1-withRouter的使用"><a href="#9-6-1-withRouter的使用" class="headerlink" title="9.6.1 withRouter的使用"></a>9.6.1 withRouter的使用</h3><p>withRouter可以包装任何自定义组件，将react-router 的 history,location,match 三个对象传入。 </p>
<pre class=" language-javascript"><code class="language-javascript"> <span class="token operator">&lt;</span>Route exact path<span class="token operator">=</span><span class="token string">"/Home"</span> component<span class="token operator">=</span><span class="token punctuation">{</span>Home<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">></span></code></pre>
<blockquote>
<p> 1.只有包裹在Route组件里的才能使用<code>props.location</code>，<br> 2.假如有个需求，是面包屑或者导航组件里需要拿到<code>props.location</code>（导航组件或者面包屑一般不会包裹在<code>Route</code>里），那么直接这么写显然就不行了。这个时候<code>withRouter</code>修饰一下，就可以这么写了。</p>
</blockquote>
<h3 id="9-6-2-使用withRouter跳转页面"><a href="#9-6-2-使用withRouter跳转页面" class="headerlink" title="9.6.2 使用withRouter跳转页面"></a>9.6.2 使用withRouter跳转页面</h3><blockquote>
<p>只有在 <route> 包裹的组件中才能在 this.props 属性中找到 history 对象。但有些情况下我们就是希望在一个没被 <route> 包裹的组件中用到 history 对象，我们可以这样用</route></route></p>
</blockquote>
<pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//Header.tsx</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> FC <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> RouteComponentProps<span class="token punctuation">,</span> withRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span>

<span class="token keyword">const</span> Header<span class="token punctuation">:</span> FC<span class="token operator">&lt;</span>RouteComponentProps<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> goAbout <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    props<span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> pathname<span class="token punctuation">:</span> <span class="token string">"/about"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>div<span class="token operator">></span>
    网页头
    <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>goAbout<span class="token punctuation">}</span><span class="token operator">></span>点我跳转About页面<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">withRouter</span><span class="token punctuation">(</span>Header<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="9-6-3-路由传参"><a href="#9-6-3-路由传参" class="headerlink" title="9.6.3 路由传参"></a>9.6.3 路由传参</h3><p>TS 路由接口：RouteComponentProps</p>
<pre class=" language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> RouteComponentProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">RouterInfo</span> <span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span>props<span class="token punctuation">:</span> RouteComponentProps<span class="token operator">&lt;</span>RouterInfo<span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>h1 className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token operator">></span>Page productDetail<span class="token operator">/</span>index <span class="token operator">--</span><span class="token operator">-</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>match<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<h4 id="a-params方式传参"><a href="#a-params方式传参" class="headerlink" title="a) params方式传参"></a>a) params方式传参</h4><pre class=" language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">'/path/:name'</span> component<span class="token operator">=</span><span class="token punctuation">{</span>Path<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">></span>

<span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">"/path/2"</span><span class="token operator">></span>xxx<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">></span>
props<span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>pathname<span class="token punctuation">:</span><span class="token string">"/path/"</span> <span class="token operator">+</span> name<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

读取参数用<span class="token punctuation">:</span>props<span class="token punctuation">.</span>match<span class="token punctuation">.</span>params<span class="token punctuation">.</span>name</code></pre>
<p>优势 ： 刷新地址栏，参数依然存在<br>缺点  :   只能传字符串，并且如果传的值太多的话，url会变得长而丑陋。</p>
<h4 id="b-search方式传参"><a href="#b-search方式传参" class="headerlink" title="b) search方式传参"></a>b) search方式传参</h4><pre class=" language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">'/web/departManange '</span> component<span class="token operator">=</span><span class="token punctuation">{</span>DepartManange<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">></span>

<span class="token operator">&lt;</span>link to<span class="token operator">=</span><span class="token string">"web/departManange?tenantId=12121212"</span><span class="token operator">></span>xxx<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">></span>
props<span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>pathname<span class="token punctuation">:</span><span class="token string">"/web/departManange"</span><span class="token punctuation">,</span>search<span class="token punctuation">:</span> <span class="token string">'tenantId=12121212'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

读取参数用<span class="token punctuation">:</span> props<span class="token punctuation">.</span>location<span class="token punctuation">.</span>search


<span class="token comment" spellcheck="true">//search参数的解析</span>
yarn add url <span class="token operator">-</span>S

<span class="token keyword">import</span> url <span class="token keyword">from</span> <span class="token string">'url'</span>
<span class="token keyword">const</span> httpUrl <span class="token operator">=</span> props<span class="token punctuation">.</span>location<span class="token punctuation">.</span>search<span class="token punctuation">;</span>
url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>httpUrl<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span>query<span class="token punctuation">.</span>tenantId<span class="token punctuation">;</span></code></pre>
<p>优势 ： 刷新地址栏，参数依然存在</p>
<p>缺点  :   只能传字符串，并且如果传的值太多的话，url会变得长而丑陋。</p>
<h4 id="c-state方式传参"><a href="#c-state方式传参" class="headerlink" title="c) state方式传参"></a>c) state方式传参</h4><pre class=" language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">'/sort '</span> component<span class="token operator">=</span><span class="token punctuation">{</span>Sort<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">></span>

<span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> pathname <span class="token punctuation">:</span> <span class="token string">'/sort'</span> <span class="token punctuation">,</span> state <span class="token punctuation">:</span> <span class="token punctuation">{</span> name <span class="token punctuation">:</span> <span class="token string">'sunny'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span> 
props<span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>pathname<span class="token punctuation">:</span><span class="token string">"/sort "</span><span class="token punctuation">,</span>state <span class="token punctuation">:</span> <span class="token punctuation">{</span> name <span class="token punctuation">:</span> <span class="token string">'sunny'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

读取参数用<span class="token punctuation">:</span> props<span class="token punctuation">.</span>location<span class="token punctuation">.</span>state<span class="token punctuation">.</span>name </code></pre>
<p>优势：传参优雅，传递参数可传对象，state传的参数是加密的<br>缺点：刷新地址栏，参数丢失</p>
<h2 id="9-7-组件懒加载和基于路由的代码分割"><a href="#9-7-组件懒加载和基于路由的代码分割" class="headerlink" title="9.7 组件懒加载和基于路由的代码分割"></a>9.7 组件懒加载和基于路由的代码分割</h2><p><code>React.lazy</code> 函数能让你像渲染常规组件一样处理动态引入（的组件）。</p>
<p><code>React.lazy</code> 接受一个函数，这个函数需要动态调用 <code>import()</code>。它必须返回一个 <code>Promise</code>，该 Promise 需要 resolve 一个 <code>defalut</code> export 的 React 组件。</p>
<p>然后应在 <code>Suspense</code> 组件中渲染 lazy 组件(Suspense 就是实现所谓的延迟加载效果)，如此使得我们可以使用在等待加载 lazy 组件时做优雅降级（如 loading 指示器等）。</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> BrowserRouter <span class="token keyword">as</span> Router<span class="token punctuation">,</span> Route<span class="token punctuation">,</span> Switch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Suspense<span class="token punctuation">,</span> lazy <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Home <span class="token operator">=</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./routes/Home'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> About <span class="token operator">=</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./routes/About'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>Router<span class="token operator">></span>
    <span class="token comment" spellcheck="true">//fallback 属性接受任何在组件加载过程中你想展示的 React 元素</span>
    <span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>div<span class="token operator">></span>Loading<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>Switch<span class="token operator">></span>
        <span class="token operator">&lt;</span>Route exact path<span class="token operator">=</span><span class="token string">"/"</span> component<span class="token operator">=</span><span class="token punctuation">{</span>Home<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"/about"</span> component<span class="token operator">=</span><span class="token punctuation">{</span>About<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Switch<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Router<span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h1 id="10-高阶组件"><a href="#10-高阶组件" class="headerlink" title="10.高阶组件"></a>10.高阶组件</h1><h2 id="10-1-高阶函数"><a href="#10-1-高阶函数" class="headerlink" title="10.1 高阶函数"></a>10.1 高阶函数</h2><p><strong>高阶函数是一个函数，它接收函数作为参数或将函数作为输出返回</strong></p>
<ul>
<li><p>举个栗子:</p>
<ul>
<li><p>接收函数作为参数</p>
<pre><code>function a(x) {
  x();
}
function b() {
  alert('hello');
}

a(b);</code></pre>
</li>
<li><p>将函数作为输出返回</p>
<pre><code>function a() {
  function b() {
    alert('hello');
  }
  return b;
}

a()();</code></pre>
</li>
</ul>
</li>
<li><p>以上函数a就是一个高阶函数, 用法非常简单, 那么实际开发中又有哪些是高阶函数呢？</p>
<ul>
<li>Array 的 map 、reduce 、filter 等方法</li>
<li>Object 的 keys 、values 等方法</li>
</ul>
</li>
</ul>
<h2 id="10-2-高阶组件"><a href="#10-2-高阶组件" class="headerlink" title="10.2 高阶组件"></a>10.2 高阶组件</h2><ul>
<li>概念：<strong>高阶组件就是一个函数，且该函数接受一个组件作为参数，并返回一个新的组件</strong></li>
</ul>
<blockquote>
<p>高阶组件可以看做是装饰器模式(Decorator Pattern)在React的实现。即允许向一个现有的对象添加新的功能，同时又不改变其结构，属于包装模式(Wrapper Pattern)的一种。最大的特点就是重用组件逻辑</p>
</blockquote>
<h3 id="10-2-1-高阶组件的实现方式-属性代理"><a href="#10-2-1-高阶组件的实现方式-属性代理" class="headerlink" title="10.2.1 高阶组件的实现方式-属性代理"></a>10.2.1 高阶组件的实现方式-属性代理</h3><p>属性代理(Props Proxy)：<code>HOC</code>是包裹在普通组件外面的一层高阶函数，任何要传入普通组件内的<code>props</code> 或者 <code>state</code> 首先都要经过 <code>HOC</code>。</p>
<p><code>props</code>和 <code>state</code>等属性原本是要流向 目标组件的腰包的，但是却被 雁过拔毛的<code>HOC</code>拦路打劫，那么最终这些 <code>props</code>和 <code>states</code>数据到底还能不能再到达 目标组件，或者哪些能到达以及到达多少就全由 <code>HOC</code>说了算了，也就是说，<code>HOC</code>拥有了提前对这些属性进行修改的能力。</p>
<p>属性代理的作用：</p>
<ul>
<li>更改prop</li>
<li>通过refs获取组件实例(类组件)</li>
<li>抽象state</li>
<li>把WrappedComponent与其他elements包装在一起</li>
</ul>
<h4 id="a-属性代理-用其他元素包装组件"><a href="#a-属性代理-用其他元素包装组件" class="headerlink" title="a) 属性代理-用其他元素包装组件"></a>a) 属性代理-用其他元素包装组件</h4><p>为了封装样式、布局或别的目的，可以用其它组件和元素包裹 WrappedComponent。</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//被包裹组件</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> SFC <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> HocComponent <span class="token keyword">from</span> <span class="token string">'../HOC/HocComponent'</span>

<span class="token keyword">const</span> MyComponent<span class="token punctuation">:</span> SFC<span class="token operator">&lt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>div<span class="token operator">></span>被包裹组件<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">HocComponent</span><span class="token punctuation">(</span>MyComponent<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment" spellcheck="true">//高阶组件</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> SFC <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">HocComponent</span><span class="token punctuation">(</span>WrappedComponent<span class="token punctuation">:</span> SFC<span class="token operator">&lt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> NewComponent<span class="token punctuation">:</span> SFC<span class="token operator">&lt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> color<span class="token punctuation">:</span> <span class="token string">"red"</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>WrappedComponent <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> NewComponent<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="b-属性代理-更改props"><a href="#b-属性代理-更改props" class="headerlink" title="b) 属性代理-更改props"></a>b) 属性代理-更改props</h4><p>在高阶组件中添加新的 props，可以在 WrappedComponent 中通过 this.props.name访问到。</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//MyComponent.tsx</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> SFC <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> HocComponent <span class="token keyword">from</span> <span class="token string">'../HOC/HocComponent'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> PrametersType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../HOC/Type'</span>

<span class="token keyword">const</span> MyComponent<span class="token punctuation">:</span> SFC<span class="token operator">&lt;</span>PrametersType<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>div<span class="token operator">></span>Hello React <span class="token operator">--</span><span class="token operator">--</span> <span class="token punctuation">{</span>props<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">HocComponent</span><span class="token punctuation">(</span>MyComponent<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//HocComponent.tsx</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> SFC <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> PrametersType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./Type'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">HocComponent</span><span class="token punctuation">(</span>WrappedComponent<span class="token punctuation">:</span> SFC<span class="token operator">&lt;</span>PrametersType<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> NewComponent<span class="token punctuation">:</span> SFC<span class="token operator">&lt;</span>PrametersType<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>WrappedComponent <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>WrappedComponent<span class="token operator">></span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> NewComponent<span class="token punctuation">;</span>
<span class="token punctuation">}</span> 


<span class="token comment" spellcheck="true">//Type.tsx</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> type PrametersType <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">?</span><span class="token punctuation">:</span>string
<span class="token punctuation">}</span></code></pre>
<h4 id="c-属性代理-抽取公共state"><a href="#c-属性代理-抽取公共state" class="headerlink" title="c) 属性代理-抽取公共state"></a>c) 属性代理-抽取公共state</h4><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//MyInput.tsx</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> SFC<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">const</span> MyInput<span class="token punctuation">:</span> SFC<span class="token operator">&lt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>value<span class="token punctuation">,</span> setValue<span class="token punctuation">]</span> <span class="token operator">=</span> useState<span class="token operator">&lt;</span>string<span class="token operator">></span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> handleChange <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">:</span> React<span class="token punctuation">.</span>ChangeEvent<span class="token operator">&lt;</span>HTMLInputElement<span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token function">setValue</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleChange<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>input<span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> MyInput<span class="token punctuation">;</span>


<span class="token comment" spellcheck="true">//MyTextArea.tsx</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> SFC<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">const</span> MyTextArea<span class="token punctuation">:</span> SFC<span class="token operator">&lt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>value<span class="token punctuation">,</span> setValue<span class="token punctuation">]</span> <span class="token operator">=</span> useState<span class="token operator">&lt;</span>string<span class="token operator">></span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> handleChange <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">:</span> React<span class="token punctuation">.</span>ChangeEvent<span class="token operator">&lt;</span>HTMLTextAreaElement<span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token function">setValue</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>textarea value<span class="token operator">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleChange<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>textarea<span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> MyTextArea<span class="token punctuation">;</span>


<span class="token comment" spellcheck="true">//index.tsx</span>
<span class="token keyword">import</span> MyInput <span class="token keyword">from</span> <span class="token string">'./components7/MyInput'</span>
<span class="token keyword">import</span> MyTextArea <span class="token keyword">from</span> <span class="token string">'./components7/MyTextArea'</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>div<span class="token operator">></span>
  <span class="token operator">&lt;</span>MyInput<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>MyInput<span class="token operator">></span>
  <span class="token operator">&lt;</span>MyTextArea<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>MyTextArea<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        


<span class="token comment" spellcheck="true">//这边代码存在的问题：MyInput和MyTextArea组件都有自己的state和change方法，代码重用性太大</span></code></pre>
<pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//MyInput.tsx</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> SFC <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>TextPrametersType<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../HOC/Type'</span>
<span class="token keyword">import</span> HocTextComponent <span class="token keyword">from</span> <span class="token string">'../HOC/HocTextComponent'</span>

<span class="token keyword">const</span> MyInput<span class="token punctuation">:</span> SFC<span class="token operator">&lt;</span>TextPrametersType<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>value<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>change<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>input<span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">HocTextComponent</span><span class="token punctuation">(</span>MyInput<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment" spellcheck="true">//MyTextArea.tsx</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> SFC <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>TextPrametersType<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../HOC/Type'</span>
<span class="token keyword">import</span> HocTextComponent <span class="token keyword">from</span> <span class="token string">'../HOC/HocTextComponent'</span>

<span class="token keyword">const</span> MyTextArea<span class="token punctuation">:</span> SFC<span class="token operator">&lt;</span>TextPrametersType<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>textarea value<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>value<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>change<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>textarea<span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> MyTextArea<span class="token punctuation">;</span>


<span class="token comment" spellcheck="true">//HocTextComponent.tsx      </span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> SFC<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> TextPrametersType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./Type'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">HocTextComponent</span><span class="token punctuation">(</span>WrappedComponent<span class="token punctuation">:</span> SFC<span class="token operator">&lt;</span>TextPrametersType<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> NewComponent<span class="token punctuation">:</span> React<span class="token punctuation">.</span>FC<span class="token operator">&lt;</span>TextPrametersType<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>value<span class="token punctuation">,</span> setValue<span class="token punctuation">]</span> <span class="token operator">=</span> useState<span class="token operator">&lt;</span>string<span class="token operator">></span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> handleChange <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">:</span> React<span class="token punctuation">.</span>ChangeEvent<span class="token operator">&lt;</span>HTMLInputElement<span class="token operator">|</span>HTMLTextAreaElement<span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
      <span class="token function">setValue</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> newProps <span class="token operator">=</span> <span class="token punctuation">{</span>
      value<span class="token punctuation">:</span> value<span class="token punctuation">,</span>
      change<span class="token punctuation">:</span> handleChange
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>WrappedComponent <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token operator">...</span>newProps<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>WrappedComponent<span class="token operator">></span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> NewComponent<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//Type.tsx</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> type TextPrametersType <span class="token operator">=</span> <span class="token punctuation">{</span>
  value<span class="token operator">?</span><span class="token punctuation">:</span>string<span class="token punctuation">,</span>
  change<span class="token operator">?</span><span class="token punctuation">(</span>e<span class="token punctuation">:</span> React<span class="token punctuation">.</span>ChangeEvent<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">void</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="10-2-2-高阶组件的实现方式-反向继承"><a href="#10-2-2-高阶组件的实现方式-反向继承" class="headerlink" title="10.2.2 高阶组件的实现方式-反向继承"></a>10.2.2 高阶组件的实现方式-反向继承</h3><p>反向继承( Inheritance Inversion )：返回的 HOC 类（Enhancer）继承了 WrappedComponent。之所以被称为 Inheritance Inversion 是因为 WrappedComponent 被 Enhancer 继承了，而不是 WrappedComponent 继承了 Enhancer。在这种方式中，它们的关系看上去被反转（inverse）了。</p>
<p>通过继承WrappedComponent，除了一些静态方法，包括生命周期，state，各种function，我们都可以得到。</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">iiHOC</span><span class="token punctuation">(</span>WrappedComponent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">Enhancer</span> <span class="token keyword">extends</span> <span class="token class-name">WrappedComponent</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>反向继承的作用：</p>
<ul>
<li>渲染劫持</li>
<li>操作state</li>
</ul>
<h4 id="a-反向继承-渲染劫持"><a href="#a-反向继承-渲染劫持" class="headerlink" title="a) 反向继承-渲染劫持"></a>a) 反向继承-渲染劫持</h4><p>之所以被称为渲染劫持是因为 HOC 控制着 WrappedComponent 的渲染输出，可以用它做各种各样的事。通过渲染劫持可以：</p>
<ul>
<li>在由 render输出的任何 React 元素中读取、添加、编辑、删除 props</li>
<li>读取和修改由 render 输出的 React 元素树</li>
<li>有条件地渲染元素树</li>
<li>把样式包裹进元素树（就像在 Props Proxy 中的那样）</li>
</ul>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> logo <span class="token keyword">from</span> <span class="token string">'./logo.svg'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./App.css'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MyComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>p name<span class="token operator">=</span><span class="token string">"pp"</span><span class="token operator">></span>被包裹组件<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">iiHOC</span><span class="token punctuation">(</span>WrappedComponent<span class="token punctuation">:</span> React<span class="token punctuation">.</span>ComponentClass<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">Enhancer</span> <span class="token keyword">extends</span> <span class="token class-name">WrappedComponent</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">//super.render() 调用父类的渲染方法  获取到父类的渲染结果</span>
      <span class="token keyword">const</span> elementsTree <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">//在父亲的渲染结果上新增一个属性</span>
      <span class="token keyword">let</span> newProps <span class="token operator">=</span> <span class="token punctuation">{</span> style<span class="token punctuation">:</span> <span class="token punctuation">{</span> color<span class="token punctuation">:</span> <span class="token string">"red"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">//elementsTree as ReactElement 类型推导</span>
      <span class="token keyword">const</span> props <span class="token operator">=</span> elementsTree <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>elementsTree <span class="token keyword">as</span> ReactElement<span class="token punctuation">)</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
      <span class="token keyword">const</span> p <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> props<span class="token punctuation">,</span> newProps<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> newElement <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">cloneElement</span><span class="token punctuation">(</span>
        elementsTree <span class="token keyword">as</span> ReactElement<span class="token punctuation">,</span>
        p<span class="token punctuation">,</span>
        props<span class="token punctuation">.</span>children
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">//返回新的页面</span>
      <span class="token keyword">return</span> newElement<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">const</span> NewComponent <span class="token operator">=</span> <span class="token function">iiHOC</span><span class="token punctuation">(</span>MyComponent<span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>NewComponent<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>NewComponent<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></code></pre>
<h4 id="b-反向继承-修改state"><a href="#b-反向继承-修改state" class="headerlink" title="b) 反向继承-修改state"></a>b) 反向继承-修改state</h4><p>HOC 可以读取、编辑和删除 WrappedComponent 实例的 state，如果需要，也可以给它添加更多的 state。但是这会搞乱 WrappedComponent 的 state，可能会导致破坏某些东西，通常不建议使用高阶组件修改添加state。</p>
<p>下面通过访问 WrappedComponent 的 props 和 state 来做测试。</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">IIHOCDEBUGGER</span><span class="token punctuation">(</span>WrappedComponent<span class="token punctuation">:</span> React<span class="token punctuation">.</span>ComponentClass<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">II</span> <span class="token keyword">extends</span> <span class="token class-name">WrappedComponent</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">></span>
          <span class="token operator">&lt;</span>h2<span class="token operator">></span>HOC Debugger Component<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>
          <span class="token operator">&lt;</span>p<span class="token operator">></span>Props<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span> <span class="token operator">&lt;</span>pre<span class="token operator">></span><span class="token punctuation">{</span>JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>pre<span class="token operator">></span>
          <span class="token operator">&lt;</span>p<span class="token operator">></span>State<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><span class="token operator">&lt;</span>pre<span class="token operator">></span><span class="token punctuation">{</span>JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>pre<span class="token operator">></span>
          <span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h1 id="11-安装-React-Developer-Tools-调试工具"><a href="#11-安装-React-Developer-Tools-调试工具" class="headerlink" title="11.安装 React Developer Tools 调试工具"></a>11.安装 React Developer Tools 调试工具</h1><p><a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi?hl=zh-CN">React Developer Tools - Chrome 扩展下载安装地址</a></p>
<h1 id="12-相关文章"><a href="#12-相关文章" class="headerlink" title="12. 相关文章"></a>12. 相关文章</h1><ul>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/gV-w_rRfdBVAqsOpBGZaVw">2018 年，React 将独占前端框架鳌头？</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/0wXWqKIigaKzMSfy4vJMVw">前端框架三巨头年度走势对比：Vue 增长率最高</a></li>
</ul>
<ul>
<li><a target="_blank" rel="noopener" href="http://www.cnblogs.com/tim100/p/6050514.html">React数据流和组件间的沟通总结</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000005876655/a-1020000005876751">单向数据流和双向绑定各有什么优缺点？</a></li>
<li><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/29504639?sort=created">怎么更好的理解虚拟DOM?</a></li>
<li><a target="_blank" rel="noopener" href="http://www.css88.com/react/index.html">React中文文档 - 版本较低</a></li>
<li><a target="_blank" rel="noopener" href="http://blog.csdn.net/yczz/article/details/49886061">React 源码剖析系列 － 不可思议的 react diff</a></li>
<li><a target="_blank" rel="noopener" href="http://www.infoq.com/cn/articles/react-dom-diff?from=timeline&amp;isappinstalled=0">深入浅出React（四）：虚拟DOM Diff算法解析</a></li>
<li><a target="_blank" rel="noopener" href="http://www.cocoachina.com/webapp/20150721/12692.html">一看就懂的ReactJs入门教程（精华版）</a></li>
<li><a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2016/06/css_modules.html">CSS Modules 用法教程</a></li>
<li><a target="_blank" rel="noopener" href="http://blog.csdn.net/itzhongzi/article/details/66045880">将MarkDown转换为HTML页面</a></li>
<li><a target="_blank" rel="noopener" href="https://jingyan.baidu.com/article/0320e2c1c9cf0e1b87507b26.html">win7命令行 端口占用 查询进程号 杀进程</a></li>
<li><a target="_blank" rel="noopener" href="https://facebook.github.io/react/docs/typechecking-with-proptypes.html">类型校验</a></li>
</ul>
<ul>
<li><a target="_blank" rel="noopener" href="https://reactjs.org/docs/animation.html#high-level-api-reactcsstransitiongroup">Animation Add-Ons</a></li>
</ul>

            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Heylog</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://Heylog.github.io/2020/02/12/react-ji-chu/">https://Heylog.github.io/2020/02/12/react-ji-chu/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">Heylog</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/React/">
                                    <span class="chip bg-color">React</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2020/02/18/umi-dva/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/5.jpg" class="responsive-img" alt="Umi&amp;dva的基本使用">
                        
                        <span class="card-title">Umi&amp;dva的基本使用</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            React 应用框架。
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2020-02-18
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/React/" class="post-category">
                                    React
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Umi/">
                        <span class="chip bg-color">Umi</span>
                    </a>
                    
                    <a href="/tags/dva/">
                        <span class="chip bg-color">dva</span>
                    </a>
                    
                    <a href="/tags/React/">
                        <span class="chip bg-color">React</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2020/01/30/typescript/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/6.jpg" class="responsive-img" alt="TypeScript的基本使用">
                        
                        <span class="card-title">TypeScript的基本使用</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            TypeScript 是 JavaScript 的强类型版本。然后在编译期去掉类型和特有语法，生成纯粹的 JavaScript 代码。
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-01-30
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/TypeScript/" class="post-category">
                                    TypeScript
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/TypeScript/">
                        <span class="chip bg-color">TypeScript</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>


    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2019</span>
            <a href="/about" target="_blank">Heylog</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/Heylog" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:493111826@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=493111826" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 493111826" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
